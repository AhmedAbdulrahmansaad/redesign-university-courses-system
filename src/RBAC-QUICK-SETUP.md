# ๐ **ุฅุนุฏุงุฏ ุณุฑูุน ููุธุงู ุงูุตูุงุญูุงุช - Quick RBAC Setup**

## โก **ุฅูุดุงุก ุงูุญุณุงุจุงุช ุงูุชุฌุฑูุจูุฉ ุจุถุบุทุฉ ูุงุญุฏุฉ!**

### **ุงูุทุฑููุฉ 1: ุงุณุชุฎุฏุงู API ูุจุงุดุฑุฉ** โก

ุงูุชุญ Console ูู ุงููุชุตูุญ (F12) ูุงูุชุจ:

```javascript
// ุฅูุดุงุก ุฌููุน ุงูุญุณุงุจุงุช ุงูุชุฌุฑูุจูุฉ ุชููุงุฆูุงู
fetch('https://YOUR_PROJECT_ID.supabase.co/functions/v1/make-server-1573e40a/create-demo-accounts', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer YOUR_ANON_KEY'
  }
})
.then(res => res.json())
.then(data => {
  console.log('โ ุงูุญุณุงุจุงุช ุงูุชุฌุฑูุจูุฉ ุชู ุฅูุดุงุคูุง!');
  console.table(data.accounts);
})
.catch(err => console.error('โ ุฎุทุฃ:', err));
```

---

### **ุงูุทุฑููุฉ 2: ูู ุฎูุงู ุตูุญุฉ ุงูุชุณุฌูู** ๐

#### **ุญุณุงุจ 1: ุทุงูุจ (Student)**
```
ุงูุงุณู ุงููุงูู:    ุทุงูุจ ุชุฌุฑูุจู
ุงูุฑูู ุงูุฌุงูุนู:   442012345
ุงูุจุฑูุฏ:          student@kku.edu.sa
ูููุฉ ุงููุฑูุฑ:     Student@123
ุงูุชุฎุตุต:          ูุธู ุงููุนูููุงุช ุงูุฅุฏุงุฑูุฉ
ุงููุณุชูู:         3
ุงูุฏูุฑ:           student
```

#### **ุญุณุงุจ 2: ูุดุฑู (Supervisor)**
```
ุงูุงุณู ุงููุงูู:    ูุดุฑู ุฃูุงุฏููู ุชุฌุฑูุจู
ุงูุฑูู ุงูุฌุงูุนู:   442999001
ุงูุจุฑูุฏ:          supervisor@kku.edu.sa
ูููุฉ ุงููุฑูุฑ:     Supervisor@123
ุงูุชุฎุตุต:          ูุธู ุงููุนูููุงุช ุงูุฅุฏุงุฑูุฉ
ุงููุณุชูู:         8
ุงูุฏูุฑ:           supervisor
```

#### **ุญุณุงุจ 3: ูุฏูุฑ (Admin)**
```
ุงูุงุณู ุงููุงูู:    ูุฏูุฑ ุงููุธุงู
ุงูุฑูู ุงูุฌุงูุนู:   442999999
ุงูุจุฑูุฏ:          admin@kku.edu.sa
ูููุฉ ุงููุฑูุฑ:     Admin@123
ุงูุชุฎุตุต:          ูุธู ุงููุนูููุงุช ุงูุฅุฏุงุฑูุฉ
ุงููุณุชูู:         8
ุงูุฏูุฑ:           admin
```

---

## ๐งช **ุงุฎุชุจุงุฑ ูุธุงู ุงูุตูุงุญูุงุช:**

### **โ ุงุฎุชุจุงุฑ 1: ุงูุทุงูุจ (Student)**

```
1. ุณุฌู ุฏุฎูู:
   - ุงูุจุฑูุฏ: student@kku.edu.sa
   - ูููุฉ ุงููุฑูุฑ: Student@123

2. ุญุงูู ุงูุฏุฎูู ูู:
   โ ุงูููุฑุฑุงุช โ ุณููุฌุญ
   โ ุงูุฌุฏูู โ ุณููุฌุญ
   โ ุงูุณุฌู ุงูุฃูุงุฏููู โ ุณููุฌุญ
   โ ููุญุฉ ุงููุดุฑู โ ุณููุฑูุถ

3. ุงููุชูุฌุฉ ุงููุชููุนุฉ:
   โ ูุธูุฑ "Access Denied"
   โ ููุญูููู ููุตูุญุฉ ุงูุฑุฆูุณูุฉ
   โ ุฑุณุงูุฉ ูู Console: "User role 'student' not authorized"
```

### **โ ุงุฎุชุจุงุฑ 2: ุงููุดุฑู (Supervisor)**

```
1. ุณุฌู ุฏุฎูู:
   - ุงูุจุฑูุฏ: supervisor@kku.edu.sa
   - ูููุฉ ุงููุฑูุฑ: Supervisor@123

2. ุญุงูู ุงูุฏุฎูู ูู:
   โ ุงูููุฑุฑุงุช โ ุณููุฌุญ
   โ ุงูุฌุฏูู โ ุณููุฌุญ
   โ ุงูุณุฌู ุงูุฃูุงุฏููู โ ุณููุฌุญ
   โ ููุญุฉ ุงููุดุฑู โ ุณููุฌุญ โญ

3. ุงููุชูุฌุฉ ุงููุชููุนุฉ:
   โ ุงูุฏุฎูู ูุฌููุน ุงูุตูุญุงุช ุจูุฌุงุญ
   โ ููุญุฉ ุงููุดุฑู ุชูุชุญ ุจุฏูู ูุดุงูู
   โ ูููู ุฑุคูุฉ ุทูุจุงุช ุงูุชุณุฌูู
```

### **โ ุงุฎุชุจุงุฑ 3: ุงููุฏูุฑ (Admin)**

```
1. ุณุฌู ุฏุฎูู:
   - ุงูุจุฑูุฏ: admin@kku.edu.sa
   - ูููุฉ ุงููุฑูุฑ: Admin@123

2. ุญุงูู ุงูุฏุฎูู ูู:
   โ ุฌููุน ุงูุตูุญุงุช โ ุณููุฌุญ
   โ ููุญุฉ ุงููุดุฑู โ ุณููุฌุญ
   โ ูู ุงููุธุงุฆู โ ุชุนูู

3. ุงููุชูุฌุฉ ุงููุชููุนุฉ:
   โ ุตูุงุญูุงุช ูุงููุฉ
   โ ูุง ุชูุฌุฏ ูููุฏ
```

---

## ๐ **ุฌุฏูู ุงูุญุณุงุจุงุช:**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงูุฏูุฑ          ุงูุจุฑูุฏ                  ูููุฉ ุงููุฑูุฑ      ุงูุฑูู ุงูุฌุงูุนู
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุทุงูุจ          student@kku.edu.sa      Student@123      442012345
ูุดุฑู          supervisor@kku.edu.sa   Supervisor@123   442999001
ูุฏูุฑ          admin@kku.edu.sa        Admin@123        442999999
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฏ **ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ:**

### **ุณููุงุฑูู 1: ุงูุทุงูุจ ูุญุงูู ุงูุฏุฎูู ูููุญุฉ ุงููุดุฑู**

```javascript
// ุงูุฎุทูุงุช:
1. Login as student@kku.edu.sa
2. Navigate to: "ููุญุฉ ุงููุดุฑู"

// ูุง ุณูุญุฏุซ:
โ ProtectedRoute ููุญุต ุงูุตูุงุญูุงุช
โ userRole = 'student'
โ allowedRoles = ['supervisor', 'admin']
โ student โ allowedRoles
โ โ Access Denied
โ Redirect to home page

// ูู Console:
console.log('โ User role "student" not authorized');
console.log('Required roles: supervisor, admin');
```

### **ุณููุงุฑูู 2: ุงููุดุฑู ูุฏุฎู ูููุญุฉ ุงููุดุฑู**

```javascript
// ุงูุฎุทูุงุช:
1. Login as supervisor@kku.edu.sa
2. Navigate to: "ููุญุฉ ุงููุดุฑู"

// ูุง ุณูุญุฏุซ:
โ ProtectedRoute ููุญุต ุงูุตูุงุญูุงุช
โ userRole = 'supervisor'
โ allowedRoles = ['supervisor', 'admin']
โ supervisor โ allowedRoles
โ โ Access Granted
โ Show content

// ูู Console:
console.log('โ Access granted');
```

---

## ๐ **ููู ูุนูู ุงููุธุงู:**

### **1. ุงูุชุญูู ุงูุฃูุงูู (Frontend):**

```typescript
// ูู ProtectedRoute.tsx:
const checkAccess = () => {
  // 1๏ธโฃ ูุญุต ุงูุชุนูุฏ
  if (requireAgreement && !agreementAccepted) {
    return redirect('accessAgreement');
  }

  // 2๏ธโฃ ูุญุต ุชุณุฌูู ุงูุฏุฎูู
  if (requireAuth && !isLoggedIn) {
    return redirect('login');
  }

  // 3๏ธโฃ ูุญุต ุงูุฃุฏูุงุฑ โญ
  if (allowedRoles.length > 0) {
    const userRole = userInfo.role || 'student';
    if (!allowedRoles.includes(userRole)) {
      console.log('โ Not authorized');
      return redirect('home');
    }
  }

  // โ ุงูุณูุงุญ ุจุงูุฏุฎูู
  return grant();
};
```

### **2. ุงูุชุญูู ุงูุฎููู (Backend):**

```typescript
// ูู server/index.tsx:
app.get('/make-server-1573e40a/supervisor/pending-registrations', async (c) => {
  // 1๏ธโฃ ุงูุชุญูู ูู Token
  const accessToken = c.req.header('Authorization')?.split(' ')[1];
  if (!accessToken) return unauthorized();

  // 2๏ธโฃ ุงูุญุตูู ุนูู ุงููุณุชุฎุฏู
  const { user } = await supabase.auth.getUser(accessToken);
  
  // 3๏ธโฃ ุงูุญุตูู ุนูู ุงูุจูุงูุงุช
  const studentData = await kv.get(`student:${studentId}`);
  
  // 4๏ธโฃ ูุญุต ุงูุฏูุฑ โญ
  if (studentData.role !== 'supervisor' && studentData.role !== 'admin') {
    return forbidden('Supervisor access required');
  }

  // โ ุชูููุฐ ุงูุทูุจ
  return data;
});
```

---

## ๐ **ููุงุญุธุงุช ูููุฉ:**

### **โ๏ธ ููุชุทููุฑ ููุท:**
```
โ๏ธ endpoint /create-demo-accounts ููุชุทููุฑ ููุท!
โ๏ธ ูู ุงูุฅูุชุงุฌุ ูุฌุจ ุญุฐู ูุฐุง ุงูู endpoint
โ๏ธ ุฃู ุฅุถุงูุฉ ุญูุงูุฉ ูููุฉ ูู
```

### **โ ุงูุฃูุงู:**
```
โ ุงูุชุญูู ุงููุฒุฏูุฌ (Frontend + Backend)
โ ูุง ูููู ุงูุชูุงุนุจ ุจุงูุฃุฏูุงุฑ ูู ุงููุชุตูุญ
โ ุงูุฏูุฑ ูุญููุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
โ ุงูุชุญูู ูู ูู ุทูุจ API
```

### **๐ฏ ุฃูุถู ุงูููุงุฑุณุงุช:**
```
โ ุงุณุชุฎุฏู allowedRoles ูู ูู ุตูุญุฉ ูุญููุฉ
โ ุงูุญุต ุงูุฏูุฑ ูู Backend ุฏุงุฆูุงู
โ ุฃุนุทู ุฑุณุงุฆู ูุงุถุญุฉ ูููุณุชุฎุฏู
โ ุณุฌูู ูุญุงููุงุช ุงููุตูู ุบูุฑ ุงููุตุฑุญ
```

---

## ๐ **ุงูุจุฏุก ุงูุณุฑูุน:**

### **ุฎุทูุฉ 1: ุฅูุดุงุก ุงูุญุณุงุจุงุช**
```bash
# ูู Console:
fetch('[YOUR_ENDPOINT]/create-demo-accounts', {...})
```

### **ุฎุทูุฉ 2: ุงุฎุชุจุงุฑ ุงูุทุงูุจ**
```
1. Login: student@kku.edu.sa / Student@123
2. Try accessing supervisor dashboard
3. Should be denied โ
```

### **ุฎุทูุฉ 3: ุงุฎุชุจุงุฑ ุงููุดุฑู**
```
1. Login: supervisor@kku.edu.sa / Supervisor@123
2. Access supervisor dashboard
3. Should succeed โ
```

### **ุฎุทูุฉ 4: ุงุฎุชุจุงุฑ ุงููุฏูุฑ**
```
1. Login: admin@kku.edu.sa / Admin@123
2. Access everything
3. Full access โ
```

---

## โ **Checklist ุงูุชูุนูู:**

```
โ๏ธ Backend ููุญุต ุงูุฃุฏูุงุฑ
โ๏ธ Frontend ููุญุต ุงูุฃุฏูุงุฑ
โ๏ธ ProtectedRoute ูุนูู
โ๏ธ ุงูุญุณุงุจุงุช ุงูุชุฌุฑูุจูุฉ ุฌุงูุฒุฉ
โ๏ธ ุฑุณุงุฆู ูุงุถุญุฉ ูููุณุชุฎุฏู
โ๏ธ ุฅุนุงุฏุฉ ุชูุฌูู ุชููุงุฆูุฉ
โ๏ธ Console logging ููุชุชุจุน
โ๏ธ ุงูุชูุซูู ูุงูู
```

---

## ๐ **ุงููุธุงู ุฌุงูุฒ!**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ูุธุงู ูุตู ุงูุตูุงุญูุงุช ูููุนูู ุจุงููุงูู
โ 3 ุฃุฏูุงุฑ ูุญุฏุฏุฉ ููุงุถุญุฉ
โ ุงูุชุญูู ุงููุฒุฏูุฌ (Frontend + Backend)
โ ุงูุญุณุงุจุงุช ุงูุชุฌุฑูุจูุฉ ุฌุงูุฒุฉ
โ ุณูู ุงูุงุฎุชุจุงุฑ
โ ุขูู ููุญูู

๐ ุฌุงูุฒ ููุนุฑุถ ูุงูุงุณุชุฎุฏุงู!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

**ยฉ 2025 ุฌุงูุนุฉ ุงูููู ุฎุงูุฏ - ุฅุนุฏุงุฏ ุณุฑูุน ููุธุงู ุงูุตูุงุญูุงุช**  
**ุงูุญุงูุฉ:** โ **ุฌุงูุฒ ููููุนูู**  
**ุงูุฃูุงู:** ๐ **ูุญูู ููุฒุฏูุฌ**
