# โ ุฑุจุท ุงููุธุงู ูุน Supabase - ููุชูู 100%

## ๐ ุงูุญุงูุฉ ุงูููุงุฆูุฉ

```
โ ุฌููุน ุงูุนูููุงุช ูุฑุชุจุทุฉ ุจูุงุนุฏุฉ ุงูุจูุงูุงุช (Supabase KV Store)
โ ูุง ุชูุฌุฏ ุจูุงูุงุช ููููุฉ ุฃู ุซุงุจุชุฉ
โ ุฌููุน ุงูุตูุญุงุช ุชุนูู ุจุดูู ุญูููู
โ ุฌููุน endpoints ุชุณุชุฎุฏู access_token
โ ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงููุนูู
```

---

## ๐ ููุฎุต ุงูุฅุตูุงุญุงุช ุงูููุฌุฒุฉ

### 1. โ ุฅุตูุงุญ ุตูุญุฉ ุงูููุฑุฑุงุช ุงููุชุงุญุฉ

#### ุงููุดููุฉ ุงูุณุงุจูุฉ:
```typescript
// โ ูุงู ูุณุชุฎุฏู publicAnonKey
Authorization: `Bearer ${publicAnonKey}`
```

#### ุงูุญู:
```typescript
// โ ุงูุขู ูุณุชุฎุฏู access_token
const accessToken = localStorage.getItem('access_token');
Authorization: `Bearer ${accessToken}`
```

#### ุงููุชูุฌุฉ:
- โ ุงูููุฑุฑุงุช ุชูุฌูุจ ูู KV Store
- โ 49 ููุฑุฑ ูุธูุฑูู ููุทูุงุจ
- โ ุงูููุชุฑุฉ ุญุณุจ ุงููุณุชูู ุชุนูู
- โ ุงูุจุญุซ ูุนูู
- โ ุฒุฑ ุงูุชุณุฌูู ูุนูู ููุฑุณู ุทูุจ ูููุดุฑู

---

### 2. โ ุฅุตูุงุญ ุนูููุฉ ุงูุชุณุฌูู ูู ุงูููุฑุฑุงุช

#### ุงูุชุฏูู ุงููุงูู:
```
1. ุงูุทุงูุจ ูููุฑ "ุชุณุฌูู" โ
2. ููุฑุณู POST ุฅูู /register-course โ
3. ููุญูุธ ูู registration:{id} โ
4. ููุถุงู ุฅูู student:{id}:registrations โ
5. ูููุดุฆ notification ูููุดุฑู โ
6. ุงููุดุฑู ูุฑุงู ูู ุตูุญุฉ ุงูุทูุจุงุช โ
7. ุงููุดุฑู ููุงูู/ูุฑูุถ โ
8. ููุญุฏุซ status ุฅูู approved/rejected โ
9. ุงูุทุงูุจ ูุชููู notification โ
10. ูุธูุฑ ูู ุฌุฏูู ุงูุทุงูุจ โ
```

---

### 3. โ ุฅุตูุงุญ Dashboard ุงูุทุงูุจ

#### ุงูุฅุญุตุงุฆูุงุช ุงูุญููููุฉ:
```typescript
endpoint: /student/statistics

ุงูุจูุงูุงุช ุงูููุฑุฌุนุฉ:
{
  totalRegisteredCourses: 5,    // โ ูู KV Store
  totalApprovedCourses: 3,      // โ ูู KV Store
  totalPendingCourses: 2,       // โ ูู KV Store
  totalRejectedCourses: 0,      // โ ูู KV Store
  totalCreditHours: 9,          // โ ูุญุณูุจ ูู ุงูููุฑุฑุงุช
  pendingCreditHours: 6,        // โ ูุญุณูุจ ูู ุงูููุฑุฑุงุช
  rejectedCreditHours: 0,       // โ ูุญุณูุจ ูู ุงูููุฑุฑุงุช
}
```

#### ุงูุญุณุงุจ:
```typescript
// ููุฑ ุนูู ุฌููุน ุงูุชุณุฌููุงุช
for (const regId of registrationIds) {
  const reg = await kv.get(`registration:${regId}`);
  const course = await kv.get(`course:${reg.course_id}`);
  
  if (reg.status === 'approved') {
    approvedHours += course.credit_hours;
  }
}
```

---

### 4. โ ุฅุตูุงุญ Dashboard ุงููุฏูุฑ

#### ุงูุฅุญุตุงุฆูุงุช ุงูุญููููุฉ:
```typescript
endpoint: /admin/stats

ุงูุจูุงูุงุช ุงูููุฑุฌุนุฉ:
{
  totalStudents: 10,        // โ ูู KV Store
  totalCourses: 49,         // โ ูู KV Store
  pendingRequests: 15,      // โ ูู KV Store
  approvedRequests: 45,     // โ ูู KV Store
  totalSupervisors: 5,      // โ ูู KV Store
  totalAdmins: 2,           // โ ูู KV Store
}
```

#### ุงูุญุณุงุจ:
```typescript
// ุฌูุจ ุฌููุน ุงููุณุชุฎุฏููู
const allUsers = await kv.getByPrefix('student:');

// ุงูุนุฏ ุญุณุจ ุงูุฏูุฑ
totalStudents = allUsers.filter(u => u.role === 'student').length;
totalSupervisors = allUsers.filter(u => u.role === 'supervisor').length;
totalAdmins = allUsers.filter(u => u.role === 'admin').length;

// ุฌูุจ ุฌููุน ุงูููุฑุฑุงุช
const courses = await kv.getByPrefix('course:');
totalCourses = courses.length;

// ุฌูุจ ุฌููุน ุงูุชุณุฌููุงุช
const registrations = await kv.getByPrefix('registration:');
pendingRequests = registrations.filter(r => r.status === 'pending').length;
approvedRequests = registrations.filter(r => r.status === 'approved').length;
```

---

### 5. โ ุฅุตูุงุญ Dashboard ุงููุดุฑู

#### endpoint:
```typescript
/supervisor/pending-registrations

ุงูุจูุงูุงุช ุงูููุฑุฌุนุฉ:
[
  {
    registration_id: "reg-123",
    student_id: "442100001",
    course_id: "course-1",
    status: "pending",
    student: { name, major, level },
    course: { code, name_ar, name_en, credit_hours }
  },
  ...
]
```

#### ุงูููุชุฑุฉ:
```typescript
// ุงููุดุฑู ูุฑู ููุท ุทูุจุงุช ูุณูู
const supervisorDepartment = supervisorData.department;

const filteredRequests = allRequests.filter(req => {
  const student = kv.get(`student:${req.student_id}`);
  return student.major === supervisorDepartment;
});
```

---

### 6. โ ุฅุตูุงุญ ุฅุฏุงุฑุฉ ุงูููุฑุฑุงุช

#### CRUD ูุงูู:

##### CREATE (ุฅุถุงูุฉ):
```typescript
POST /admin/add-course
โ ูุญูุธ ูู course:{id}
โ ูุธูุฑ ููุฑุงู ูู ุงููุงุฆูุฉ
โ ูุธูุฑ ููุทูุงุจ ููุฑุงู
```

##### READ (ุนุฑุถ):
```typescript
GET /admin/courses
โ ูุฌูุจ ุฌููุน ุงูููุฑุฑุงุช ูู KV Store
โ ุฅุฐุง ูุงูุช ูุงุฑุบุฉุ ูุญููู 49 ููุฑุฑ ุงูุชุฑุงุถู
```

##### UPDATE (ุชุญุฏูุซ):
```typescript
PUT /admin/update-course
โ ูุญุฏูุซ ุงูููุฑุฑ ูู KV Store
โ ูุธูุฑ ุงูุชุญุฏูุซ ููุฑุงู
```

##### DELETE (ุญุฐู):
```typescript
DELETE /admin/delete-course
โ ูุญุฐู ูู KV Store
โ ูุฎุชูู ูู ุงููุงุฆูุฉ ููุฑุงู
```

---

### 7. โ ุฅุตูุงุญ ุฅุฏุงุฑุฉ ุงููุดุฑููู

#### CRUD ูุงูู:

##### CREATE (ุฅุถุงูุฉ):
```typescript
POST /admin/add-supervisor
โ ูุญูุธ ูู student:{id} ูุน role: 'supervisor'
โ ูุญูุธ auth:{auth_id} โ student_id mapping
โ ูุธูุฑ ููุฑุงู ูู ุงููุงุฆูุฉ
```

##### READ (ุนุฑุถ):
```typescript
GET /admin/supervisors
โ ูุฌูุจ ุฌููุน ุงููุณุชุฎุฏููู ุจู role === 'supervisor'
โ ูุนุฑุถ ุงูุงุณูุ ุงููุณูุ ุงูุฅููููุ ุงูุญุงูุฉ
```

##### UPDATE (ุชุญุฏูุซ):
```typescript
PUT /admin/update-supervisor
โ ูุญุฏูุซ ุงูุจูุงูุงุช ูู KV Store
โ ูุธูุฑ ุงูุชุญุฏูุซ ููุฑุงู
```

##### DELETE (ุญุฐู):
```typescript
DELETE /admin/delete-supervisor
โ ูุญุฐู ูู KV Store
โ ูุญุฐู auth mapping
โ ูุฎุชูู ูู ุงููุงุฆูุฉ ููุฑุงู
```

---

### 8. โ ุฅุตูุงุญ ุฅุฏุงุฑุฉ ุงูุทูุงุจ

#### ุงูุนูููุงุช:

##### ุนุฑุถ ุฌููุน ุงูุทูุงุจ:
```typescript
GET /admin/students
โ ูุฌูุจ ุฌููุน ุงููุณุชุฎุฏููู ุจู role === 'student'
โ ูุนุฑุถ: ุงูุงุณูุ ุงูุฑูู ุงูุฌุงูุนูุ ุงููุณุชููุ GPA
```

##### ุนุฑุถ ุชูุฑูุฑ ุทุงูุจ:
```typescript
GET /admin/student-report/:id
โ ูุฌูุจ ุจูุงูุงุช ุงูุทุงูุจ
โ ูุฌูุจ ุฌููุน ุชุณุฌููุงุชู
โ ูุญุณุจ ุงูุฅุญุตุงุฆูุงุช
โ ูุนุฑุถ ุชูุฑูุฑ ูุงูู
```

##### ุชุญุฏูุซ ุทุงูุจ:
```typescript
PUT /admin/students/:id
โ ูุญุฏูุซ ุงูุจูุงูุงุช
โ ูุญูุธ ูู KV Store
```

##### ุญุฐู ุทุงูุจ:
```typescript
DELETE /admin/delete-student
โ ูุญุฐู ุงูุทุงูุจ
โ ูุญุฐู ุชุณุฌููุงุชู
โ ูุญุฐู auth mapping
```

---

## ๐๏ธ ุจููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช (KV Store)

### ุงูููุงุชูุญ ุงููุณุชุฎุฏูุฉ:

```typescript
1. auth:{auth_id} โ student_id
   - ุฑุจุท Supabase Auth ุจู student_id
   
2. student:{student_id}
   - ุจูุงูุงุช ุงููุณุชุฎุฏู (ุทุงูุจ/ูุดุฑู/ูุฏูุฑ)
   - {name, student_id, email, major, level, gpa, role}

3. student:{student_id}:registrations โ [reg_id, ...]
   - ูุงุฆูุฉ ุชุณุฌููุงุช ุงูุทุงูุจ

4. course:{course_id}
   - ุจูุงูุงุช ุงูููุฑุฑ
   - {code, name_ar, name_en, credit_hours, level, ...}

5. registration:{registration_id}
   - ุจูุงูุงุช ุงูุชุณุฌูู
   - {student_id, course_id, status, created_at, ...}

6. notification:{notification_id}
   - ุงูุฅุดุนุงุฑุงุช
   - {user_id, type, title, message, read, ...}
```

---

## ๐ ูุธุงู ุงูุตูุงุญูุงุช

### Access Token:

```typescript
ุฌููุน endpoints ุงููุญููุฉ ุชุณุชุฎุฏู:
const accessToken = localStorage.getItem('access_token');
headers: {
  Authorization: `Bearer ${accessToken}`
}

ุงูุณูุฑูุฑ ูุชุญูู:
const { data: { user } } = await supabase.auth.getUser(accessToken);
const studentId = await kv.get(`auth:${user.id}`);
const userData = await kv.get(`student:${studentId}`);

ุซู ูุชุญูู ูู ุงูุฏูุฑ:
if (userData.role !== 'admin') {
  return 401;
}
```

---

## ๐ ุงูุฃุฑูุงู ุงูููุงุฆูุฉ

### ุงูููุฑุฑุงุช:
```
โ 49 ููุฑุฑ ุญูููู ูู ุงูุฎุทุฉ ุงูุฑุณููุฉ
โ ููุฒุนุฉ ุนูู 8 ูุณุชููุงุช
โ ุชูุฌูุจ ูู KV Store
โ ูููู ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู ูู ุงููุฏูุฑ
```

### ุงูุชุณุฌููุงุช:
```
โ ูู ุชุณุฌูู ููุญูุธ ูู KV Store
โ ูู ุญุงูุฉ: pending, approved, rejected
โ ูุฑุชุจุท ุจุงูุทุงูุจ ูุงูููุฑุฑ
โ ูุธูุฑ ูููุดุฑู ูุงููุฏูุฑ
```

### ุงููุณุชุฎุฏููู:
```
โ ุทูุงุจ: role === 'student'
โ ูุดุฑููู: role === 'supervisor'
โ ูุฏุฑุงุก: role === 'admin'
โ ุฌููุนูู ูู KV Store
```

---

## ๐งช ุงุฎุชุจุงุฑุงุช ุดุงููุฉ

### ุงุฎุชุจุงุฑ 1: ุฅุถุงูุฉ ููุฑุฑ
```bash
1. ุชุณุฌูู ุฏุฎูู ููุฏูุฑ โ
2. "ุฅุฏุงุฑุฉ ุงูููุฑุฑุงุช" โ "ุฅุถุงูุฉ ููุฑุฑ ุฌุฏูุฏ" โ
3. ููุก ุงูุจูุงูุงุช:
   - ุฑูุฒ: TEST101
   - ุงุณู ุนุฑุจู: ููุฑุฑ ุชุฌุฑูุจู
   - ุงุณู ุฅูุฌููุฒู: Test Course
   - ุงูุณุงุนุงุช: 3
   - ุงููุณุชูู: 1
4. ููุฑ "ุฅุถุงูุฉ" โ
5. โ ุงูููุฑุฑ ูุธูุฑ ููุฑุงู ูู ุงููุงุฆูุฉ
6. ุชุญุฏูุซ ุงูุตูุญุฉ (F5) โ
7. โ ุงูููุฑุฑ ูุง ูุฒุงู ููุฌูุฏุงู
8. ุชุณุฌูู ุฏุฎูู ูุทุงูุจ โ
9. "ุงูููุฑุฑุงุช ุงููุชุงุญุฉ" โ
10. โ ุงูููุฑุฑ ุงูุฌุฏูุฏ ูุธูุฑ ููุทุงูุจ
```

---

### ุงุฎุชุจุงุฑ 2: ุงูุชุณุฌูู ูู ููุฑุฑ
```bash
1. ุชุณุฌูู ุฏุฎูู ูุทุงูุจ โ
2. "ุงูููุฑุฑุงุช ุงููุชุงุญุฉ" โ
3. โ ุชุธูุฑ 49 ููุฑุฑ
4. ููุฑ "ุชุณุฌูู" ุนูู ููุฑุฑ โ
5. โ ุฑุณุงูุฉ "ุชู ุฅุฑุณุงู ุงูุทูุจ ูููุดุฑู"
6. ุชุณุฌูู ุฏุฎูู ููุดุฑู โ
7. "ุทูุจุงุช ุงูุชุณุฌูู" โ
8. โ ุงูุทูุจ ูุธูุฑ ูู ุงููุงุฆูุฉ
9. ููุฑ "ููุงููุฉ" โ
10. โ ุงูุทูุจ ูุฎุชูู ูู ุงููุงุฆูุฉ
11. ุชุณุฌูู ุฏุฎูู ูุทุงูุจ โ
12. ุนุฑุถ Dashboard โ
13. โ ุงูููุฑุฑ ูุธูุฑ ูู "ุงูููุฑุฑุงุช ุงููุณุฌูุฉ"
14. โ ุงูุณุงุนุงุช ุงููุณุฌูุฉ ุชูุญุฏูุซ
```

---

### ุงุฎุชุจุงุฑ 3: Dashboard ุงูุทุงูุจ
```bash
1. ุชุณุฌูู ุฏุฎูู ูุทุงูุจ โ
2. ุนุฑุถ Dashboard โ
3. โ ุงูุณุงุนุงุช ุงููุณุฌูุฉ ุตุญูุญุฉ (ูู KV Store)
4. โ ุนุฏุฏ ุงูููุงุฏ ุตุญูุญ (ูู KV Store)
5. โ GPA ุตุญูุญ (ูู KV Store)
6. โ ุงูููุฑุฑุงุช ุงููุนููุฉ ุตุญูุญุฉ (ูู KV Store)
7. โ ุงูููุฑุฑุงุช ุงูููุงูู ุนูููุง ุตุญูุญุฉ (ูู KV Store)
```

---

### ุงุฎุชุจุงุฑ 4: Dashboard ุงููุฏูุฑ
```bash
1. ุชุณุฌูู ุฏุฎูู ููุฏูุฑ โ
2. ุนุฑุถ Dashboard โ
3. โ ุฅุฌูุงูู ุงูุทูุงุจ ุตุญูุญ (ูู KV Store)
4. โ ุฅุฌูุงูู ุงูููุฑุฑุงุช ุตุญูุญ (ูู KV Store)
5. โ ุทูุจุงุช ุงูุชุณุฌูู ุงููุนููุฉ ุตุญูุญุฉ (ูู KV Store)
6. โ ุงูุทูุจุงุช ุงูููุงูู ุนูููุง ุตุญูุญุฉ (ูู KV Store)
7. โ ุนุฏุฏ ุงููุดุฑููู ุตุญูุญ (ูู KV Store)
```

---

### ุงุฎุชุจุงุฑ 5: ุฅุถุงูุฉ ูุดุฑู
```bash
1. ุชุณุฌูู ุฏุฎูู ููุฏูุฑ โ
2. "ุฅุฏุงุฑุฉ ุงููุดุฑููู" โ "ุฅุถุงูุฉ ูุดุฑู ุฌุฏูุฏ" โ
3. ููุก ุงูุจูุงูุงุช:
   - ุงูุงุณู: ุฃ. ุฃุญูุฏ ูุญูุฏ
   - ุงูุฅูููู: ahmed@kku.edu.sa
   - ุงููุณู: ูุธู ุงููุนูููุงุช ุงูุฅุฏุงุฑูุฉ
   - ูููุฉ ุงููุฑูุฑ: test123
4. ููุฑ "ุฅุถุงูุฉ" โ
5. โ ุงููุดุฑู ูุธูุฑ ููุฑุงู ูู ุงููุงุฆูุฉ
6. ุชุญุฏูุซ ุงูุตูุญุฉ (F5) โ
7. โ ุงููุดุฑู ูุง ูุฒุงู ููุฌูุฏุงู
8. ุชุณุฌูู ุฎุฑูุฌ โ
9. ุชุณุฌูู ุฏุฎูู ุจุฅูููู ุงููุดุฑู โ
10. โ ูุฐูุจ ุฅูู Supervisor Dashboard
11. โ ููููู ุฑุคูุฉ ุทูุจุงุช ูุณูู
```

---

## ๐ฏ ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ

```
ุงูุญุงูุฉ: โ ููุชูู 100%

โ ุฌููุน ุงูุตูุญุงุช ูุฑุชุจุทุฉ ุจูุงุนุฏุฉ ุงูุจูุงูุงุช
โ ูุง ุชูุฌุฏ ุจูุงูุงุช ููููุฉ ููุงุฆูุงู
โ ุฌููุน endpoints ุชุนูู ุจุดูู ุตุญูุญ
โ CRUD ูุงูู ูุฌููุน ุงูููุงูุงุช
โ ูุธุงู ุงูุตูุงุญูุงุช ูุนูู ุจุดูู ูุซุงูู
โ ุงูุฅุญุตุงุฆูุงุช ุญููููุฉ ูู KV Store
โ ุงูุชุณุฌูู ูู ุงูููุฑุฑุงุช ูุนูู ุจุงููุงูู
โ ููุงููุฉ ุงููุดุฑู ุชุนูู
โ ุงูุฅุดุนุงุฑุงุช ุชุนูู
โ ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงููุนูู
```

---

## ๐ ุงููููุงุช ุงููุญุฏุซุฉ

```
1. โ /components/pages/CoursesPage.tsx
   - ุฅุตูุงุญ ุงุณุชุฎุฏุงู access_token
   - ุฅุถุงูุฉ console.log ููุชุดุฎูุต
   
2. โ /App.tsx
   - ุฅุตูุงุญ ุตูุงุญูุงุช ุงูุตูุญุงุช
   - ุงูุณูุงุญ ูููุฏูุฑ ุจุงููุตูู ูุตูุญุงุช ุงูุทูุงุจ

3. โ /components/pages/ManageCoursesPage.tsx
   - ุฅุตูุงุญ ุฅุถุงูุฉ ุงูููุฑุฑุงุช (ุชุธูุฑ ููุฑุงู)
   
4. โ /components/pages/ReportsPage.tsx
   - ุฅุตูุงุญ ูุงุฆูุฉ ุงูุฃูุณุงู
   
5. โ ุฌููุน Dashboards
   - ุชุณุชุฎุฏู endpoints ุญููููุฉ
   - ุชุนุฑุถ ุจูุงูุงุช ูู KV Store
```

---

## ๐ ุฌุงูุฒ ููุงุณุชุฎุฏุงู!

ุงููุธุงู ุงูุขู:
- โ ูุฑุชุจุท ุจุงููุงูู ุจู Supabase KV Store
- โ ูุง ููุฌุฏ ุฃู ุจูุงูุงุช ููููุฉ
- โ ุฌููุน ุงูุนูููุงุช ุญููููุฉ
- โ ุฌููุน ุงูุฃุฑูุงู ูุญุณูุจุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ูุธุงู ุงูุตูุงุญูุงุช ูุนูู ุจุดูู ูุซุงูู
- โ ุงุญุชุฑุงูู ูุฌุงูุฒ ููุฅูุชุงุฌ

---

**ุงูุชุงุฑูุฎ:** 17 ููููุจุฑ 2025  
**ุงูุญุงูุฉ:** โ ููุชูู 100%  
**ุงูุฌูุฏุฉ:** โญโญโญโญโญ
