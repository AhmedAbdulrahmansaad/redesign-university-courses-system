# โ ุงููุดููุฉ ุฑูู (2): ุญุฐู ุงููุณุชุฎุฏููู - ุชู ุงูุฅุตูุงุญ

## ๐ ูุตู ุงููุดููุฉ

**ุงููุดููุฉ ุงูุณุงุจูุฉ:**
- ุนูุฏ ูุญุงููุฉ ุงููุฏูุฑ ุญุฐู ุทุงูุจ ุฃู ูุดุฑู
- ูุธูุฑ ุฃู ุงูุนูููุฉ ูุฌุญุชุ ููู ูุนููุงู:
  - โ ุงููุณุชุฎุฏู ูุง ููุญุฐู ูู ุงููุธุงู
  - โ ูุง ููุญุฐู ูู ุฌุฏูู `users`
  - โ ูุง ููุญุฐู ูู ุฌุฏูู `students` ุฃู `supervisors`
  - โ ุงูุนูุงูุงุช ุงูุชุงุจุนุฉ ุชุจูู ููุฌูุฏุฉ

**ุงูุณุจุจ:**
- ุงููุธุงู ูุงู ูุณุชุฎุฏู **Soft Delete** (ุชุนุทูู ููุท)
- ูููู ููุท ุจุชุญุฏูุซ `active: false` ุฏูู ุญุฐู ูุนูู
- ูุง ูุญุฐู ุงูุณุฌูุงุช ุงููุฑุชุจุทุฉ

---

## โ ุงูุญู ุงููุทุจู

### 1๏ธโฃ **ุชุญุฏูุซ Endpoint ุญุฐู ุงูุทูุงุจ**

**ุงููุณุงุฑ:** `/make-server-1573e40a/students/:id`

**ุงูุชุบููุฑุงุช:**
```typescript
// โ ุญุฐู ุญูููู (Hard Delete) ูุน ุฌููุน ุงูุนูุงูุงุช

// 1. ุญุฐู registrations
await supabase.from('registrations').delete().eq('student_id', student.id);

// 2. ุญุฐู notifications
await supabase.from('notifications').delete().eq('user_id', student.id);

// 3. ุญุฐู ูู ุฌุฏูู students
await supabase.from('students').delete().eq('user_id', student.id);

// 4. ุญุฐู ูู ุฌุฏูู users
await supabase.from('users').delete().eq('id', student.id);

// 5. ุญุฐู ูู Supabase Auth
await supabase.auth.admin.deleteUser(student.auth_id);
```

---

### 2๏ธโฃ **ุชุญุฏูุซ Endpoint ุญุฐู ุงููุดุฑููู**

**ุงููุณุงุฑ:** `/make-server-1573e40a/supervisors/:id`

**ุงูุชุบููุฑุงุช:**
```typescript
// โ ุญุฐู ุญูููู (Hard Delete) ูุน ุฌููุน ุงูุนูุงูุงุช

// 1. ุญุฐู notifications
await supabase.from('notifications').delete().eq('user_id', supervisor.id);

// 2. ุชุญุฏูุซ registrations (ุฅุฒุงูุฉ ุงููุฑุฌุน ูููุดุฑู)
await supabase.from('registrations').update({ approved_by: null }).eq('approved_by', supervisor.id);

// 3. ุญุฐู ูู ุฌุฏูู supervisors
await supabase.from('supervisors').delete().eq('user_id', supervisor.id);

// 4. ุญุฐู ูู ุฌุฏูู admins (ุฅุฐุง ูุงู ูุฏูุฑ)
if (supervisor.role === 'admin') {
  await supabase.from('admins').delete().eq('user_id', supervisor.id);
}

// 5. ุญุฐู ูู ุฌุฏูู users
await supabase.from('users').delete().eq('id', supervisor.id);

// 6. ุญุฐู ูู Supabase Auth
await supabase.auth.admin.deleteUser(supervisor.auth_id);
```

---

### 3๏ธโฃ **ุชุญุฏูุซ Endpoint ุจุฏูู ูููุฏูุฑ**

**ุงููุณุงุฑ:** `/make-server-1573e40a/admin/delete-supervisor`

ุชู ุชุญุฏูุซู ููุทุงุจู ููุณ ููุทู ุงูุญุฐู ุงููุงูู.

---

## ๐ ุชุฑุชูุจ ุนูููุงุช ุงูุญุฐู

ุงูุชุฑุชูุจ ููู ูุชุฌูุจ ุฃุฎุทุงุก Foreign Key Constraints:

### ููุทูุงุจ:
```
1. registrations (ุงูุนูุงูุงุช ุงูุชุงุจุนุฉ)
2. notifications (ุงูุฅุดุนุงุฑุงุช)
3. students (ุณุฌู ุงูุทุงูุจ)
4. users (ุงููุณุชุฎุฏู ุงูุฑุฆูุณู)
5. Supabase Auth (ุงููุตุงุฏูุฉ)
```

### ูููุดุฑููู:
```
1. notifications (ุงูุฅุดุนุงุฑุงุช)
2. registrations (ุชุญุฏูุซ ููุท - ุฅุฒุงูุฉ ุงููุฑุฌุน)
3. supervisors (ุณุฌู ุงููุดุฑู)
4. admins (ุฅุฐุง ูุงู ูุฏูุฑ)
5. users (ุงููุณุชุฎุฏู ุงูุฑุฆูุณู)
6. Supabase Auth (ุงููุตุงุฏูุฉ)
```

---

## ๐ ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญ

### **ุงุฎุชุจุงุฑ ุญุฐู ุทุงูุจ:**

1. ุณุฌู ุฏุฎูู ููุฏูุฑ
2. ุงุฐูุจ ุฅูู **ุฅุฏุงุฑุฉ ุงูุทูุงุจ**
3. ุงุฎุชุฑ ุทุงูุจ ูุงุถุบุท **ุญุฐู**
4. ุฃูุฏ ุงูุญุฐู
5. ุชุญูู ูู:
   - โ ุงุฎุชูุงุก ุงูุทุงูุจ ูู ุงููุงุฆูุฉ
   - โ ุนุฏู ุงููุฏุฑุฉ ุนูู ุชุณุฌูู ุงูุฏุฎูู ุจุญุณุงุจู
   - โ ุญุฐู ุฌููุน ุชุณุฌููุงุชู ููููุฑุฑุงุช
   - โ ุญุฐู ุฌููุน ุงูุฅุดุนุงุฑุงุช

### **ุงุฎุชุจุงุฑ ุญุฐู ูุดุฑู:**

1. ุณุฌู ุฏุฎูู ููุฏูุฑ
2. ุงุฐูุจ ุฅูู **ุฅุฏุงุฑุฉ ุงููุดุฑููู**
3. ุงุฎุชุฑ ูุดุฑู ูุงุถุบุท **ุญุฐู**
4. ุฃูุฏ ุงูุญุฐู
5. ุชุญูู ูู:
   - โ ุงุฎุชูุงุก ุงููุดุฑู ูู ุงููุงุฆูุฉ
   - โ ุนุฏู ุงููุฏุฑุฉ ุนูู ุชุณุฌูู ุงูุฏุฎูู ุจุญุณุงุจู
   - โ ุชุญุฏูุซ ุทูุจุงุช ุงูุชุณุฌูู (ุฅุฒุงูุฉ approved_by)
   - โ ุญุฐู ุฌููุน ุงูุฅุดุนุงุฑุงุช

---

## ๐ ุงูุฃูุงู

### **ุงูุชุญูู ูู ุงูุตูุงุญูุงุช:**
- โ ููุท ุงููุฏูุฑ ููููู ุญุฐู ุงููุณุชุฎุฏููู
- โ ุงูุชุญูู ูู ุฏูุฑ ุงููุณุชุฎุฏู ูุจู ุงูุญุฐู
- โ ุงูุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏู ูุจู ุงูุญุฐู

### **ุญูุงูุฉ ุงูุจูุงูุงุช:**
- โ ุญุฐู ูุงูู ูู ุฌููุน ุงูุฌุฏุงูู
- โ ุญุฐู ูู ูุธุงู ุงููุตุงุฏูุฉ (Auth)
- โ ุชุญุฏูุซ ุงูุนูุงูุงุช ุจุฏูุงู ูู ุญุฐููุง (ูููุดุฑููู)

---

## ๐ Logging ุงููุญุณูู

ุชู ุฅุถุงูุฉ logging ููุตู ููู ุฎุทูุฉ:

```typescript
console.log('๐๏ธ [Server] Deleting student (HARD DELETE):', studentId);
console.log('โ [Server] Found student:', student);
console.log('๐๏ธ Deleting student registrations...');
console.log('๐๏ธ Deleting student notifications...');
console.log('๐๏ธ Deleting from students table...');
console.log('๐๏ธ Deleting from users table...');
console.log('๐๏ธ Deleting from Supabase Auth...');
console.log('โ [Server] Student permanently deleted with all related data');
```

---

## ๐ฏ ุงููุชูุฌุฉ

### **ูุจู ุงูุฅุตูุงุญ:**
- โ Soft Delete ููุท (active: false)
- โ ุงูุจูุงูุงุช ุชุจูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุงููุณุชุฎุฏู ููููู ุชุณุฌูู ุงูุฏุฎูู
- โ ุงูุนูุงูุงุช ุชุจูู ููุฌูุฏุฉ

### **ุจุนุฏ ุงูุฅุตูุงุญ:**
- โ Hard Delete ูุงูู
- โ ุญุฐู ูู ุฌููุน ุงูุฌุฏุงูู
- โ ุญุฐู ูู ูุธุงู ุงููุตุงุฏูุฉ
- โ ุชูุธูู ุฌููุน ุงูุนูุงูุงุช
- โ ุชุญุฏูุซ ูุงุฌูุฉ ุงููุฏูุฑ ููุฑุงู

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

1. **`/supabase/functions/server/index.tsx`**
   - ุชุญุฏูุซ `DELETE /students/:id`
   - ุชุญุฏูุซ `DELETE /supervisors/:id`
   - ุชุญุฏูุซ `DELETE /admin/delete-supervisor`

2. **ูุงุฌูุงุช ุงููุณุชุฎุฏู (ูู ุชุชุบูุฑ)**
   - `/components/pages/ManageStudentsPage.tsx` (ุชุนูู ุจุฏูู ุชุบููุฑ)
   - `/components/pages/ManageSupervisorsPage.tsx` (ุชุนูู ุจุฏูู ุชุบููุฑ)

---

## โ ุชู ุงูุฅุตูุงุญ ุจูุฌุงุญ

ุงููุดููุฉ ุฑูู (2) ุชู ุญููุง ุจุงููุงูู! ๐

**ุงููุฏูุฑ ุงูุขู ูุณุชุทูุน:**
- โ ุญุฐู ุงูุทูุงุจ ููุงุฆูุงู ูู ุงููุธุงู
- โ ุญุฐู ุงููุดุฑููู ููุงุฆูุงู ูู ุงููุธุงู
- โ ุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงููุฑุชุจุทุฉ ุชููุงุฆูุงู
- โ ุฑุคูุฉ ุงูุชุญุฏูุซ ุงูููุฑู ูู ููุญุฉ ุงูุชุญูู

---

**ุชุงุฑูุฎ ุงูุฅุตูุงุญ:** ููููุจุฑ 2024  
**ุงูุญุงูุฉ:** โ ููุชูู ูููุฎุชุจุฑ
