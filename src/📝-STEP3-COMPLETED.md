# โ ุงูุฎุทูุฉ 3: ุฅุถุงูุฉ ูุธุงู ุงูุฅุดุนุงุฑุงุช ุงูุญูููู - ููุชููุฉ ๐

## ูุง ุชู ุฅูุฌุงุฒู:

### โ 1. ุฅูุดุงุก ูููู ุงูุฅุดุนุงุฑุงุช ุงูุฌุฏูุฏ

**ุงูููู:** `/components/NotificationsPanel.tsx` (ุฌุฏูุฏ)

#### ุงููููุฒุงุช:
- โ ููุญุฉ ุฅุดุนุงุฑุงุช ุฌุงูุจูุฉ ููุฒููุฉ (Slide-in Panel)
- โ ุฏุนู ูุงูู ููุบุชูู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ ูุน RTL/LTR
- โ ุฃููุงุน ุฅุดุนุงุฑุงุช ูุชุนุฏุฏุฉ:
  - `success` - ูุจูู ุงูููุฑุฑุงุช โ
  - `error` - ุฑูุถ ุงูููุฑุฑุงุช โ
  - `warning` - ุชุญุฐูุฑุงุช โ๏ธ
  - `info` - ูุนูููุงุช โน๏ธ
- โ ุนุฏุงุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ
- โ ุชุญุฏูุฏ ุฅุดุนุงุฑ ูุงุญุฏ ูููุฑูุก
- โ ุชุญุฏูุฏ ุฌููุน ุงูุฅุดุนุงุฑุงุช ูููุฑูุกุฉ
- โ ุญุฐู ุฅุดุนุงุฑ
- โ ุนุฑุถ ุงูููุช ุงููุณุจู (ููุฐ 5 ุฏูุงุฆูุ ููุฐ ุณุงุนุฉุ ุงูุฎ)

---

### โ 2. ุงุณุชุฎุฏุงู ูููู ุงูุฅุดุนุงุฑุงุช ุงูููุญุฏ

**ุงูููู:** `/components/UnifiedNotificationsDropdown.tsx` (ููุฌูุฏ ูุณุจูุงู)

#### ุชู ุงูุชุญูู ูู:
- โ ูุฌูุจ ุงูุฅุดุนุงุฑุงุช ูู API ุญุณุจ ุฏูุฑ ุงููุณุชุฎุฏู
- โ endpoints ูููุตูุฉ ููู ุฏูุฑ:
  - `/student/notifications` - ููุทูุงุจ
  - `/supervisor/notifications` - ูููุดุฑููู
  - `/admin/notifications` - ูููุฏุฑุงุก
- โ ุชุญุฏูุซ ุชููุงุฆู ูู 10 ุซูุงูู
- โ ุฅุดุนุงุฑุงุช Toast ุนูุฏ ูุตูู ุฅุดุนุงุฑ ุฌุฏูุฏ
- โ ุฃููููุงุช ูุฎุชููุฉ ุญุณุจ ููุน ุงูุฅุดุนุงุฑ

---

### โ 3. ุฅุถุงูุฉ API Endpoints ูู ุงูุณูุฑูุฑ

**ุงูููู:** `/supabase/functions/server/index.tsx`

#### ุชู ุฅุถุงูุฉ:

##### ุฃ) ุฏุงูุฉ `createNotification` ุงููุณุงุนุฏุฉ:
```typescript
async function createNotification(
  userId: string,
  userRole: string,
  type: string,
  titleAr: string,
  titleEn: string,
  messageAr: string,
  messageEn: string,
  relatedId?: string
)
```
- ุชุฎุฒูู ุงูุฅุดุนุงุฑุงุช ูู KV Store
- ูุนุฑูู ูุฑูุฏ ููู ุฅุดุนุงุฑ
- ุฑุจุท ุงูุฅุดุนุงุฑ ุจุงููุณุชุฎุฏู

##### ุจ) Endpoints ุฌูุจ ุงูุฅุดุนุงุฑุงุช:
1. **`GET /student/notifications`**
   - ุฌูุจ ุฌููุน ุฅุดุนุงุฑุงุช ุงูุทุงูุจ
   - ุชุฑุชูุจ ุญุณุจ ุงูุชุงุฑูุฎ (ุงูุฃุญุฏุซ ุฃููุงู)
   - ุนุฏุงุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ

2. **`GET /supervisor/notifications`**
   - ุฌูุจ ุฌููุน ุฅุดุนุงุฑุงุช ุงููุดุฑู
   - ูุซู endpoint ุงูุทุงูุจ

3. **`GET /admin/notifications`**
   - ุฌูุจ ุฌููุน ุฅุดุนุงุฑุงุช ุงููุฏูุฑ
   - ูุซู endpoint ุงูุทุงูุจ

##### ุฌ) Endpoints ุชุญุฏูุฏ ูููุฑูุก:
1. **`POST /student/notification/read`**
   - ุชุญุฏูุฏ ุฅุดุนุงุฑ ูุงุญุฏ ูููุฑูุก
   - ุชุณุฌูู ููุช ุงููุฑุงุกุฉ

2. **`POST /supervisor/notification/read`**
3. **`POST /admin/notification/read`**

##### ุฏ) Endpoints ุชุญุฏูุฏ ุงููู ูููุฑูุก:
1. **`POST /student/notifications/read-all`**
   - ุชุญุฏูุฏ ุฌููุน ุงูุฅุดุนุงุฑุงุช ูููุฑูุกุฉ
   - ุฅุฑุฌุงุน ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุงููุญุฏุซุฉ

2. **`POST /supervisor/notifications/read-all`**
3. **`POST /admin/notifications/read-all`**

---

### โ 4. ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุนูุฏ ูุจูู/ุฑูุถ ุงูููุฑุฑุงุช

#### ุชู ุงูุชุญุฏูุซ ูู ูููุนูู:

##### ุฃ) Endpoint ุชุญุฏูุซ ุงูุชุณุฌูู (ุงููุดุฑู):
**ุงูุณุทุฑ ~1340 ูู index.tsx**

```typescript
// โ Create notification for student
if (data.student_id) {
  const titleAr = status === 'approved' ? 'ุชูุช ุงูููุงููุฉ ุนูู ุทูุจ ุงูุชุณุฌูู โ' : 'ุชู ุฑูุถ ุทูุจ ุงูุชุณุฌูู โ';
  const titleEn = status === 'approved' ? 'Registration Approved โ' : 'Registration Rejected โ';
  const messageAr = status === 'approved' 
    ? `ุชูุช ุงูููุงููุฉ ุนูู ุชุณุฌูู ููุฑุฑ ${courseDetails?.name_ar}`
    : `ุชู ุฑูุถ ุชุณุฌูู ููุฑุฑ ${courseDetails?.name_ar}. ูุฑุฌู ูุฑุงุฌุนุฉ ูุดุฑูู ุงูุฃูุงุฏููู`;
  
  await createNotification(
    data.student_id,
    'student',
    status === 'approved' ? 'registration_approved' : 'registration_rejected',
    titleAr,
    titleEn,
    messageAr,
    messageEn,
    data.id
  );
}
```

##### ุจ) Endpoint ูุจูู/ุฑูุถ ุงูุทูุจุงุช (ุงููุฏูุฑ):
**ุงูุณุทุฑ ~3203 ูู index.tsx**

```typescript
// โ Create notification for student using KV store
if (student) {
  const titleAr = action === 'approve' ? 'ุชูุช ุงูููุงููุฉ ุนูู ุทูุจ ุงูุชุณุฌูู โ' : 'ุชู ุฑูุถ ุทูุจ ุงูุชุณุฌูู โ';
  // ... ููุณ ุงูููุทู
  
  await createNotification(
    student.id,
    'student',
    action === 'approve' ? 'registration_approved' : 'registration_rejected',
    titleAr,
    titleEn,
    messageAr,
    messageEn,
    request_id
  );
}
```

---

## ๐ฏ ููู ูุนูู ุงููุธุงูุ

### ุชุฏูู ุงูุนูู:

```mermaid
graph TD
    A[ุงููุดุฑู/ุงููุฏูุฑ ููุจู/ูุฑูุถ ููุฑุฑ] --> B[ุชุญุฏูุซ ุญุงูุฉ ุงูุชุณุฌูู ูู SQL]
    B --> C[ุงุณุชุฏุนุงุก createNotification]
    C --> D[ุญูุธ ุงูุฅุดุนุงุฑ ูู KV Store]
    D --> E[ุฑุจุท ุงูุฅุดุนุงุฑ ุจุงูุทุงูุจ]
    E --> F[ุงูุทุงูุจ ููุชุญ ุงููุธุงู]
    F --> G[UnifiedNotificationsDropdown ูุฌูุจ ุงูุฅุดุนุงุฑุงุช]
    G --> H[ุนุฑุถ ุงูุฅุดุนุงุฑ ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ]
    H --> I[Toast notification ูุธูุฑ ููุทุงูุจ]
    I --> J[ุงูุทุงูุจ ูุถุบุท ุนูู ุงูุฅุดุนุงุฑ]
    J --> K[ุชุญุฏูุฏ ุงูุฅุดุนุงุฑ ูููุฑูุก]
```

---

## ๐ ุชุฎุฒูู ุงูุจูุงูุงุช ูู KV Store:

### ููุงุชูุญ ุงูุชุฎุฒูู:

1. **`notification:{notification_id}`**
   ```json
   {
     "notification_id": "notif_1732716000000_abc123",
     "user_id": "student-123",
     "user_role": "student",
     "type": "registration_approved",
     "title_ar": "ุชูุช ุงูููุงููุฉ ุนูู ุทูุจ ุงูุชุณุฌูู โ",
     "title_en": "Registration Approved โ",
     "message_ar": "ุชูุช ุงูููุงููุฉ ุนูู ุชุณุฌูู ููุฑุฑ ูุธู ุงููุนูููุงุช ุงูุฅุฏุงุฑูุฉ",
     "message_en": "Your registration for MIS has been approved",
     "related_id": "reg-456",
     "read": false,
     "created_at": "2025-11-27T10:30:00.000Z"
   }
   ```

2. **`user_notification:{user_id}:{notification_id}`**
   - ุงููููุฉ: `notification_id`
   - ูุณูุญ ุจุฌูุจ ุฌููุน ุฅุดุนุงุฑุงุช ุงููุณุชุฎุฏู ุจุณุฑุนุฉ ุจุงุณุชุฎุฏุงู `getByPrefix`

---

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู:

### ูุงุฎุชุจุงุฑ ุงูุฎุทูุฉ 3:

1. **ุณุฌูู ุฏุฎูู ูุทุงูุจ** ูุณุฌูู ููุฑุฑุงู ุฌุฏูุฏุงู
2. **ุณุฌูู ุฏุฎูู ููุดุฑู** ููู ุจูุจูู ุฃู ุฑูุถ ุงูููุฑุฑ
3. **ุงุฑุฌุน ููุทุงูุจ** ูุดุงูุฏ:
   - โ ุฃููููุฉ ุงูุฌุฑุณ ุชุญุชูู ุนูู ุฑูู ุฃุญูุฑ (ุนุฏุงุฏ ุบูุฑ ุงูููุฑูุกุฉ)
   - โ ุฅุดุนุงุฑ Toast ูุธูุฑ ุชููุงุฆูุงู
   - โ ุงูุฅุดุนุงุฑ ูุธูุฑ ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ
   - โ ูููู ุชุญุฏูุฏ ุงูุฅุดุนุงุฑ ูููุฑูุก
   - โ ูููู ุญุฐู ุงูุฅุดุนุงุฑ

---

## ๐จ ุฃููุงุน ุงูุฅุดุนุงุฑุงุช ุงููุฏุนููุฉ:

| ุงูููุน | ุงูุฃููููุฉ | ุงูููู | ุงูุงุณุชุฎุฏุงู |
|------|---------|-------|-----------|
| `registration_approved` | โ | ุฃุฎุถุฑ | ูุจูู ุงูููุฑุฑ |
| `registration_rejected` | โ | ุฃุญูุฑ | ุฑูุถ ุงูููุฑุฑ |
| `new_request` | ๐ | ุฃุฒุฑู | ุทูุจ ุฌุฏูุฏ (ูููุดุฑู) |
| `student_registered` | ๐ | ุฃุฒุฑู | ุทุงูุจ ุฌุฏูุฏ (ูููุฏูุฑ) |
| `system_update` | โน๏ธ | ุฃุฒุฑู | ุชุญุฏูุซ ุงููุธุงู |
| `course_added` | ๐ | ุฃุฎุถุฑ | ููุฑุฑ ุฌุฏูุฏ |
| `user_added` | ๐ค | ุฃุฒุฑู | ูุณุชุฎุฏู ุฌุฏูุฏ |

---

## ๐ ุงููููุงุช ุงููุญุฏุซุฉ:

1. โ `/components/NotificationsPanel.tsx` (ุฌุฏูุฏ)
   - ูููู ุงูุฅุดุนุงุฑุงุช ุงูุฌุงูุจู

2. โ `/components/UnifiedNotificationsDropdown.tsx` (ููุฌูุฏ)
   - ุชู ุงูุชุญูู ูู ุนููู ุจุดูู ุตุญูุญ

3. โ `/components/Header.tsx` (ููุฌูุฏ)
   - ูุณุชุฎุฏู UnifiedNotificationsDropdown

4. โ `/supabase/functions/server/index.tsx` (ูุญุฏูุซ)
   - ุฅุถุงูุฉ ุฏุงูุฉ `createNotification`
   - ุฅุถุงูุฉ 9 endpoints ููุฅุดุนุงุฑุงุช
   - ุชุญุฏูุซ endpoints ูุจูู/ุฑูุถ ุงูููุฑุฑุงุช

---

## ๐ ููุฒุงุช ุฅุถุงููุฉ:

### 1. ุงูุชุญุฏูุซ ุงูุชููุงุฆู:
- ูุชู ุฌูุจ ุงูุฅุดุนุงุฑุงุช ูู 10 ุซูุงูู ุชููุงุฆูุงู
- ูุง ุญุงุฌุฉ ูุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ

### 2. Toast Notifications:
- ุฅุดุนุงุฑ ููุจุซู ุนูุฏ ูุตูู ุฅุดุนุงุฑ ุฌุฏูุฏ
- ุฃููููุฉ ูุฎุชููุฉ ุญุณุจ ุงูููุน
- ูุฎุชูู ุชููุงุฆูุงู ุจุนุฏ 5 ุซูุงูู

### 3. ุนุฏุงุฏ ุบูุฑ ุงูููุฑูุกุฉ:
- ุฑูู ุฃุญูุฑ ุนูู ุฃููููุฉ ุงูุฌุฑุณ
- ูุชุญุฏุซ ุชููุงุฆูุงู

### 4. ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ:
- โ RTL support ููุนุฑุจูุฉ
- โ Dark mode support
- โ Animations ุณูุณุฉ
- โ Responsive design

---

## ๐ฏ ุงูุฎุทูุฉ ุงูุชุงููุฉ:

**ุงูุฎุทูุฉ 4**: ุชุทููุฑ ุงููุณุงุนุฏ ุงูุฐูู ููููู ุฃูุซุฑ ุฐูุงุกู ูุชูุงุนููุฉ

ุณูุถูู:
- ๐ค ุฐูุงุก ุงุตุทูุงุนู ุญูููู ุจุงุณุชุฎุฏุงู OpenAI
- ๐ ูุฏุฑุฉ ุนูู ุงูุฅุฌุงุจุฉ ุนู ุฃุณุฆูุฉ ุงูุทูุงุจ
- ๐ ูุนุฑูุฉ ุจุงูููุฑุฑุงุช ูุงูุฎุทุฉ ุงูุฏุฑุงุณูุฉ
- ๐ก ุงูุชุฑุงุญุงุช ุฐููุฉ ููุทูุงุจ
- ๐ ูุณุงุนุฏุฉ ูู ุงุฎุชูุงุฑ ุงูููุฑุฑุงุช

**ุชุงุฑูุฎ ุงูุฅููุงู**: 27 ููููุจุฑ 2025
