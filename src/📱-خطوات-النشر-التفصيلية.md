# ๐ฑ ุฏููู ูุดุฑ Edge Function - ุฎุทูุฉ ุจุฎุทูุฉ (ูุน ุงูุจูุงูุงุช ุงูุญููููุฉ)

## ๐ ุจูุงูุงุชู:
```
Project ID: kcbxyonombsqamwsmmqz
Project URL: https://kcbxyonombsqamwsmmqz.supabase.co
Anon Key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... (ููุฌูุฏ)
Service Role Key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtjYnh5b25vbWJzcWFtd3NtbXF6Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NDM3MDc5MywiZXhwIjoyMDc5OTQ2NzkzfQ.5cgLm3CjLP0NzGE6riqoZTtABW1wljEEJ7iH0XAeJR0
```

---

## ๐ ุงูุฎุทูุงุช (10 ุฏูุงุฆู ููุท)

### ุงูุฎุทูุฉ 1๏ธโฃ: ุงูุชุญ Supabase Dashboard

```
1. ุงุฐูุจ ุฅูู: https://supabase.com/dashboard
2. ุณุฌู ุฏุฎูู
3. ุงุฎุชุฑ ูุดุฑูุน: kku-registration-system
   (ุฃู ุงููุดุฑูุน ุงูุฐู ID ูู: kcbxyonombsqamwsmmqz)
```

---

### ุงูุฎุทูุฉ 2๏ธโฃ: ุงุฐูุจ ุฅูู Edge Functions

```
1. ูู ุงููุงุฆูุฉ ุงููุณุฑูุ ุงุจุญุซ ุนู:
   โก Edge Functions
   
2. ุงุถุบุท ุนูููุง
```

**ูุฌุจ ุฃู ุชุฑู:**
- ุฅูุง ุตูุญุฉ ูุงุฑุบุฉ: "No functions deployed"
- ุฃู ูุงุฆูุฉ functions ููุฌูุฏุฉ

---

### ุงูุฎุทูุฉ 3๏ธโฃ: ุฅูุดุงุก Function ุฌุฏูุฏ

#### ุฃ) ุฅุฐุง ูู ููู ููุงู functions:

```
1. ุงุถุบุท "Deploy a new function" ุฃู "Create function"

2. ูู ูุงูุฐุฉ ุงูุฅูุดุงุก:
   
   Function name: server
   
   โ๏ธ ููู: ุงูุงุณู ุจุงูุถุจุท ูู: server
   (ุจุฏูู make-server-1573e40a)

3. ุงุถุบุท "Create" ุฃู "Next"
```

#### ุจ) ุฅุฐุง ูุงู ููุงู function ูุฏูู:

```
1. ุงุจุญุซ ุนู function ุงุณูู "server"
2. ุฅุฐุง ููุฌูุฏ: ุงูุชุญู ูุงูุชูู ููุฎุทูุฉ 4
3. ุฅุฐุง ุบูุฑ ููุฌูุฏ: ุฃูุดุฆ ูุงุญุฏ ุฌุฏูุฏ
```

---

### ุงูุฎุทูุฉ 4๏ธโฃ: ูุณุฎ ุงูููุฏ

#### ูู Figma Make (ูุฐุง ุงููุดุฑูุน):

```
1. ุงูุชุญ ููู: ๐-COPY-THIS-TO-SUPABASE.ts

2. ุญุฏุฏ ูู ุงูููุฏ:
   - ุงุถุบุท ูู ุฃูู ุณุทุฑ
   - Ctrl+A (ุฃู Cmd+A ูู Mac)
   
3. ุงูุณุฎ:
   - Ctrl+C (ุฃู Cmd+C)
```

#### ูู Supabase Edge Function:

```
1. ูู ุตูุญุฉ Function Editor
2. ุงุญุฐู ุฃู ููุฏ ููุฌูุฏ (Ctrl+A ุซู Delete)
3. ุงูุตู ุงูููุฏ ุงูุฌุฏูุฏ (Ctrl+V)
```

**ูุฌุจ ุฃู ูุจุฏุฃ ุงูููุฏ ุจู:**
```typescript
// ๐ ุงูุณุฎ ูุฐุง ุงูููุฏ ูุงููุงู ูุงูุตูู ูู Supabase Edge Function
// ุงุณู Function ูู Supabase ูุฌุจ ุฃู ูููู: server

import { serve } from 'https://deno.land/std@0.168.0/http/server.ts'
...
```

---

### ุงูุฎุทูุฉ 5๏ธโฃ: ุฅุถุงูุฉ Environment Variables

#### ุฃ) ุงุฐูุจ ููู Secrets:

```
ูู ุตูุญุฉ Edge Function:
1. ุงุจุญุซ ุนู ุชุจููุจ "Secrets" ุฃู "Environment Variables"
2. ุงุถุบุท ุนููู
```

#### ุจ) ุฃุถู ุงููุชุบูุฑ ุงูุฃูู:

```
ุงุถุบุท "Add Secret" ุฃู "New Variable"

Name (ุงูุงุณู):
SUPABASE_URL

Value (ุงููููุฉ):
https://kcbxyonombsqamwsmmqz.supabase.co

ุงุถุบุท "Save" ุฃู "Add"
```

#### ุฌ) ุฃุถู ุงููุชุบูุฑ ุงูุซุงูู:

```
ุงุถุบุท "Add Secret" ูุฑุฉ ุฃุฎุฑู

Name:
SUPABASE_SERVICE_ROLE_KEY

Value:
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtjYnh5b25vbWJzcWFtd3NtbXF6Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NDM3MDc5MywiZXhwIjoyMDc5OTQ2NzkzfQ.5cgLm3CjLP0NzGE6riqoZTtABW1wljEEJ7iH0XAeJR0

ุงุถุบุท "Save" ุฃู "Add"
```

โ **ุงูุขู ูุฌุจ ุฃู ุชุฑู:**
```
โ SUPABASE_URL = https://kcbxyonombsqamwsmmqz.supabase.co
โ SUPABASE_SERVICE_ROLE_KEY = eyJh... (ุทููู)
```

---

### ุงูุฎุทูุฉ 6๏ธโฃ: Deploy (ุงููุดุฑ)

```
1. ุงุจุญุซ ุนู ุฒุฑ "Deploy" ุฃู "Save and Deploy"
2. ุงุถุบุท ุนููู
3. ุงูุชุธุฑ 30-60 ุซุงููุฉ
4. ูุฌุจ ุฃู ุชุฑู: โ "Deployment successful"
```

**ุญุงูุฉ Function ูุฌุจ ุฃู ุชููู:**
```
๐ข Active
```

---

### ุงูุฎุทูุฉ 7๏ธโฃ: ุงุฎุชุจุงุฑ ุงูุงุชุตุงู

#### ุงูุชุญ Console ูู ุงููุชุตูุญ:

```
1. ุงูุชุญ google.com (ุฃู ุตูุญุฉ)
2. ุงุถุบุท F12
3. ุงุฎุชุฑ ุชุจููุจ "Console"
4. ุงูุตู ูุฐุง ุงูููุฏ:
```

```javascript
fetch('https://kcbxyonombsqamwsmmqz.supabase.co/functions/v1/make-server-1573e40a/health')
  .then(r => r.json())
  .then(data => {
    console.log('ุงููุชูุฌุฉ:', data);
    if (data.status === 'ok') {
      console.log('๐ ุงููุธุงู ูุชุตู ุจูุฌุงุญ!');
    } else {
      console.log('โ ููุฌุฏ ูุดููุฉ:', data);
    }
  })
  .catch(err => console.error('โ ุฎุทุฃ ูู ุงูุงุชุตุงู:', err));
```

#### ุงููุชูุฌุฉ ุงููุชููุนุฉ:

```json
{
  "status": "ok",
  "message": "KKU Course Registration System - Connected to PostgreSQL",
  "timestamp": "2024-11-30T...",
  "env": {
    "hasUrl": true,
    "hasKey": true
  }
}
```

โ **ุฅุฐุง ุฑุฃูุช `status: "ok"` = ูุฌุญ!**

โ **ุฅุฐุง ุฑุฃูุช ุฎุทุฃ:**
- `404` = Function ุบูุฑ ููุดูุฑ (ุฑุงุฌุน ุงูุฎุทูุฉ 3 ู 6)
- `500` = Environment Variables ุฎุงุทุฆุฉ (ุฑุงุฌุน ุงูุฎุทูุฉ 5)
- `CORS error` = ุงูููุฏ ุบูุฑ ูุงูู (ุฑุงุฌุน ุงูุฎุทูุฉ 4)

---

### ุงูุฎุทูุฉ 8๏ธโฃ: ุงุฎุชุจุงุฑ ุฌูุจ ุงูููุฑุฑุงุช

```javascript
// ูู ููุณ Console
fetch('https://kcbxyonombsqamwsmmqz.supabase.co/functions/v1/make-server-1573e40a/courses')
  .then(r => r.json())
  .then(data => {
    console.log('ุนุฏุฏ ุงูููุฑุฑุงุช:', data.count);
    if (data.count > 0) {
      console.log('โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุตูุฉ!');
      console.log('ุฃูู 3 ููุฑุฑุงุช:', data.courses.slice(0, 3));
    } else {
      console.log('โ๏ธ ุฌุฏูู courses ูุงุฑุบ - ูุญุชุงุฌ ุชูููุฐ INSERT SQL');
    }
  });
```

#### ุงููุชูุฌุฉ ุงููุชููุนุฉ:

```
ุนุฏุฏ ุงูููุฑุฑุงุช: 49
โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุตูุฉ!
ุฃูู 3 ููุฑุฑุงุช: [
  { id: 1, code: "ARAB 101", name_ar: "ุงูููุงุฑุงุช ุงููุบููุฉ", ... },
  ...
]
```

#### โ ุฅุฐุง ูุงู count = 0:

```
ูุนูู ุฌุฏูู courses ูุงุฑุบ
ุงูุญู: ููุฐ SQL ูู Supabase (ุงูุธุฑ ุงูุฎุทูุฉ 9)
```

---

### ุงูุฎุทูุฉ 9๏ธโฃ: ุฅุฏุฑุงุฌ ุงูููุฑุฑุงุช (ุฅุฐุง ูุงู count = 0)

#### ูู Supabase Dashboard:

```
1. ูู ุงููุงุฆูุฉ ุงููุณุฑูุ ุงุฎุชุฑ "SQL Editor"
2. ุงุถุบุท "New Query"
3. ุงูุชุญ ููู: ๐ฅ-INSERT-ALL-DATA.sql ูู ุงููุดุฑูุน
4. ุงูุณุฎ ูู ูุญุชููุงุชู
5. ุงูุตู ูู SQL Editor
6. ุงุถุบุท "Run" ุฃู F5
7. ูุฌุจ ุฃู ุชุฑู: "Success. 49 rows affected"
```

#### ุซู ุงุฎุชุจุฑ ูุฑุฉ ุฃุฎุฑู:

```javascript
fetch('https://kcbxyonombsqamwsmmqz.supabase.co/functions/v1/make-server-1573e40a/courses')
  .then(r => r.json())
  .then(data => console.log('ุนุฏุฏ ุงูููุฑุฑุงุช:', data.count));
```

**ูุฌุจ ุฃู ุชุฑู: `count: 49`**

---

### ุงูุฎุทูุฉ ๐: ุงุฎุชุจุงุฑ ุฅูุดุงุก ุญุณุงุจ

#### ูู ุงููุธุงู:

```
1. ุงูุชุญ ุงููุดุฑูุน (ูู Figma Make ุงุถุบุท Preview)
2. ุงูุชุญ Console (F12)
3. ุงุฐูุจ ูุตูุญุฉ "ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ"
4. ุงููุฃ ุงูุจูุงูุงุช:
   
   ุงูุฑูู ุงูุฌุงูุนู: 442200001
   ุงูุจุฑูุฏ ุงูุฅููุชุฑููู: test@kku.edu.sa
   ูููุฉ ุงููุฑูุฑ: Test123!
   ุงูุงุณู ุงููุงูู: ุทุงูุจ ุงุฎุชุจุงุฑ
   ุฑูู ุงููุงุชู: 0501234567
   ุงููุณุชูู: 1
   ุงูุชุฎุตุต: MIS

5. ุงุถุบุท "ุฅูุดุงุก ุงูุญุณุงุจ"
```

#### ูุง ูุฌุจ ุฃู ุชุฑุงู ูู Console:

```
๐ [Signup] Sending signup request to SQL Database
๐ [Signup] Full request body received: {...}
โ [Signup] SQL Database signup successful
โ [Signup] Success: 442200001
```

#### โ ุฅุฐุง ุฑุฃูุช "ุชู ุงูุญูุธ ูุญููุงู":

```
ูุนูู Edge Function ูุง ุฒุงู ุบูุฑ ูุชุตู
ุฑุงุฌุน ุงูุฎุทูุงุช 1-7 ูุฑุฉ ุฃุฎุฑู
```

#### โ ุงูุชุญูู ูู Supabase:

```
1. ูู Supabase Dashboard
2. ุงุฐูุจ ูู "Table Editor"
3. ุงุฎุชุฑ ุฌุฏูู "users"
4. ูุฌุจ ุฃู ุชุฑู ุงูุตู ุงูุฌุฏูุฏ:

| id | student_id | email          | name        | role    |
|----|------------|----------------|-------------|---------|
| 1  | 442200001  | test@kku.edu.sa| ุทุงูุจ ุงุฎุชุจุงุฑ | student |

5. ุงุฐูุจ ูุฌุฏูู "students"
6. ูุฌุจ ุฃู ุชุฑู:

| id | user_id | level | major | gpa  |
|----|---------|-------|-------|------|
| 1  | 1       | 1     | MIS   | 0.00 |
```

โ **ุฅุฐุง ุฑุฃูุช ุงูุจูุงูุงุช = ุงููุธุงู ูุนูู 100%!** ๐

---

## ๐ฏ ููุฎุต ุณุฑูุน

```
โ 1. ูุชุญุช Supabase Dashboard
โ 2. ุฐูุจุช ูู Edge Functions
โ 3. ุฃูุดุฃุช function: server
โ 4. ูุณุฎุช ููุฏ ูู ๐-COPY-THIS-TO-SUPABASE.ts
โ 5. ุฃุถูุช SUPABASE_URL
โ 6. ุฃุถูุช SUPABASE_SERVICE_ROLE_KEY
โ 7. Deploy
โ 8. ุงุฎุชุจุฑุช Health Check โ ูุฌุญ
โ 9. ุงุฎุชุจุฑุช Courses โ 49 ููุฑุฑ
โ 10. ุฃูุดุฃุช ุญุณุงุจ โ ุธูุฑ ูู Supabase
```

---

## โ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ 1: "ุชู ุงูุญูุธ ูุญููุงู" ุนูุฏ ุฅูุดุงุก ุงูุญุณุงุจ

**ุงูุณุจุจ:** Edge Function ุบูุฑ ููุดูุฑ ุฃู ุงูุงุณู ุฎุงุทุฆ

**ุงูุญู:**
```
1. ุชุฃูุฏ ุฃู Function ุงุณูู "server" ุจุงูุถุจุท
2. ุชุฃูุฏ ุฃูู ููุดูุฑ (Status: Active)
3. ุฑุงุฌุน ุงูุฎุทูุงุช 1-6
```

### ุฎุทุฃ 2: 404 Not Found

**ุงูุณุจุจ:** Function ุบูุฑ ููุฌูุฏ ุฃู URL ุฎุงุทุฆ

**ุงูุญู:**
```
ุชุฃูุฏ ูู:
- Function ุงุณูู: server
- URL: https://kcbxyonombsqamwsmmqz.supabase.co/functions/v1/make-server-1573e40a/...
```

### ุฎุทุฃ 3: 500 Internal Server Error

**ุงูุณุจุจ:** Environment Variables ุฎุงุทุฆุฉ

**ุงูุญู:**
```
1. ุงุฐูุจ ูู Function โ Secrets
2. ุชุฃูุฏ ูู:
   โ SUPABASE_URL = https://kcbxyonombsqamwsmmqz.supabase.co
   โ SUPABASE_SERVICE_ROLE_KEY = eyJh... (ุงูุทููู)
3. ุฅุนุงุฏุฉ Deploy
```

### ุฎุทุฃ 4: count = 0 (ูุง ููุฑุฑุงุช)

**ุงูุณุจุจ:** ุฌุฏูู courses ูุงุฑุบ

**ุงูุญู:**
```
ููุฐ SQL ูู Supabase:
1. SQL Editor
2. ุงูุณุฎ ูู ๐ฅ-INSERT-ALL-DATA.sql
3. Run
```

---

## ๐ ุฅุฐุง ูุง ุฒุงูุช ุงููุดููุฉ

ุฃุฑุณู ูู screenshot ูู:
1. Edge Functions page (ูุธูุฑ Function ูุงุณูู ูุญุงูุชู)
2. Secrets page (ูุธูุฑ ุงููุชุบูุฑุงุช - ุจุฏูู ุงูููู)
3. Console ุนูุฏ ุฅูุดุงุก ุญุณุงุจ

**ูุณุฃุณุงุนุฏู ููุฑุงู!**

---

## ๐ ุจุนุฏ ุงููุฌุงุญ

ุงููุธุงู ุณูุนูู ุจุงููุงูู:
- โ ุฅูุดุงุก ุญุณุงุจุงุช ุญููููุฉ
- โ ุชุณุฌูู ุฏุฎูู
- โ ุฌูุจ ุงูููุฑุฑุงุช ูู PostgreSQL
- โ ุงูุชุณุฌูู ูู ุงูููุฑุฑุงุช
- โ ูู ุงูุจูุงูุงุช ูู Supabase
- โ ูุง fallback!

**ุงููุธุงู ุญูููู 100%!** ๐
