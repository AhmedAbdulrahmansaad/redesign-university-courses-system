# ๐ธ ุฏููู ูุดุฑ Edge Function - ุฎุทูุฉ ุจุฎุทูุฉ ูุน ุงูุตูุฑ

## ๐ฏ ุงููุฏู: ุฑุจุท ุงููุธุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ุนุจุฑ ูุดุฑ Edge Function

---

## โ ุงูุฎุทูุฉ 1: ุงูุฏุฎูู ุฅูู Supabase Dashboard

### ุงูุฅุฌุฑุงุก:
```
1. ุงุฐูุจ ุฅูู: https://supabase.com/dashboard
2. ุณุฌู ุฏุฎูู ุจุญุณุงุจู: ahmedabdulrahmansaad140@gmail.com
3. ุงุฎุชุฑ ุงููุดุฑูุน: kku-registration-system
```

### ูุง ูุฌุจ ุฃู ุชุฑุงู:
- ุงุณู ุงููุดุฑูุน ูู ุงูุฃุนูู
- ุงูููุงุฆู ุงูุฌุงูุจูุฉ (Authentication, Table Editor, Edge Functions, etc.)

---

## โ ุงูุฎุทูุฉ 2: ุงูุฐูุงุจ ุฅูู Edge Functions

### ุงูุฅุฌุฑุงุก:
```
1. ูู ุงููุงุฆูุฉ ุงููุณุฑูุ ุงุฎุชุฑ "Edge Functions" (ุงูุฃููููุฉ ูุซู โก)
2. ุณุชูุชุญ ุตูุญุฉ Edge Functions
```

### ูุง ูุฌุจ ุฃู ุชุฑุงู:
- ุฅูุง ุตูุญุฉ ูุงุฑุบุฉ ุชููู "No functions deployed"
- ุฃู ูุงุฆูุฉ ุจุงูู Functions ุงูููุฌูุฏุฉ

---

## โ ุงูุฎุทูุฉ 3: ุฅูุดุงุก Function ุฌุฏูุฏ

### ุงูุฅุฌุฑุงุก:
```
1. ุงุถุบุท ุนูู ุฒุฑ "Create a new function" ุฃู "New Function"
2. ูู ูุงูุฐุฉ ุงูุฅูุดุงุก:
   - Function name: make-server-1573e40a
   - ุงุชุฑู ุจุงูู ุงูุฅุนุฏุงุฏุงุช ููุง ูู
3. ุงุถุบุท "Create function"
```

### ๐ ููู:
- ุงูุงุณู ูุฌุจ ุฃู ูููู **ุจุงูุถุจุท**: `make-server-1573e40a`
- ูุง ุชุบูุฑ ุงูุงุณู - ุงููุธุงู ูุนุชูุฏ ุนููู

---

## โ ุงูุฎุทูุฉ 4: ูุณุฎ ุงูููุฏ

### ุงูุฅุฌุฑุงุก:
```
1. ุงูุชุญ ููู: /๐ฅ-DEPLOY-THIS-NOW.ts
2. ุญุฏุฏ ูู ุงูููุฏ (Ctrl+A)
3. ุงูุณุฎู (Ctrl+C)
```

### ุงูููุฏ ูุจุฏุฃ ุจู:
```typescript
// ๐ฅ ูุณุฎ ูุฐุง ุงูููู ูุงููุงู ููุตูู ูู Supabase Edge Function
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts'
...
```

---

## โ ุงูุฎุทูุฉ 5: ูุตู ุงูููุฏ ูู Function Editor

### ุงูุฅุฌุฑุงุก:
```
1. ูู ุตูุญุฉ Edge Function ุงูุชู ุฃูุดุฃุชูุง
2. ุงุญุฐู ุงูููุฏ ุงูุงูุชุฑุงุถู ุงูููุฌูุฏ
3. ุงูุตู ุงูููุฏ ุงูููุณูุฎ (Ctrl+V)
4. ุชุฃูุฏ ูู ุฃู ูู ุงูููุฏ ููุฌูุฏ (ูู ุฃูู ุณุทุฑ ูุขุฎุฑ ุณุทุฑ)
```

### ูุง ูุฌุจ ุฃู ุชุฑุงู:
```typescript
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts'
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  ...
```

---

## โ ุงูุฎุทูุฉ 6: ุฅุถุงูุฉ Environment Variables

### ุงูุฅุฌุฑุงุก:
```
1. ูู ุตูุญุฉ Edge Functionุ ุงุฐูุจ ุฅูู ุชุจููุจ "Secrets" ุฃู "Environment Variables"
2. ุฃุถู ุงููุชุบูุฑุงุช ุงูุชุงููุฉ:

   ุงููุชุบูุฑ ุงูุฃูู:
   Name: SUPABASE_URL
   Value: https://YOUR_PROJECT_ID.supabase.co

   ุงููุชุบูุฑ ุงูุซุงูู:
   Name: SUPABASE_SERVICE_ROLE_KEY
   Value: [ุงูุณุฎู ูู Settings โ API โ service_role secret]
```

### ๐ ููู ุชุญุตู ุนูู ุงูููู:

#### SUPABASE_URL:
```
1. ุงุฐูุจ ุฅูู Settings โ API
2. ุงูุณุฎ "URL" (ูุซู: https://abcdefgh.supabase.co)
```

#### SUPABASE_SERVICE_ROLE_KEY:
```
1. ุงุฐูุจ ุฅูู Settings โ API
2. ุงุจุญุซ ุนู "service_role"
3. ุงุถุบุท "Reveal" ูุฅุธูุงุฑ ุงูููุชุงุญ
4. ุงูุณุฎ ุงูููุชุงุญ ุงูุทููู (ูุจุฏุฃ ุจู eyJ...)
```

### โ๏ธ ููู ุฌุฏุงู:
- **ูุง ุชูุณุฎ `anon key`** - ูุฌุจ ุฃู ุชูุณุฎ **`service_role key`**
- ุงูููุชุงุญ ุณุฑู - ูุง ุชุดุงุฑูู ูุน ุฃุญุฏ

---

## โ ุงูุฎุทูุฉ 7: Deploy (ุงููุดุฑ)

### ุงูุฅุฌุฑุงุก:
```
1. ุจุนุฏ ูุตู ุงูููุฏ ูุฅุถุงูุฉ Environment Variables
2. ุงุถุบุท ุนูู ุฒุฑ "Deploy" ุฃู "Save and Deploy"
3. ุงูุชุธุฑ ุญุชู ููุชูู ุงููุดุฑ (ูุฏ ูุฃุฎุฐ 30-60 ุซุงููุฉ)
```

### ูุง ูุฌุจ ุฃู ุชุฑุงู:
- ุฑุณุงูุฉ ูุฌุงุญ: "Function deployed successfully"
- ุญุงูุฉ Function: "Active" ุฃู "Running"
- Endpoint URL ูุซู:
  ```
  https://YOUR_PROJECT.supabase.co/functions/v1/make-server-1573e40a
  ```

---

## โ ุงูุฎุทูุฉ 8: ุงุฎุชุจุงุฑ ุงูุงุชุตุงู

### ุงุฎุชุจุงุฑ 1: Health Check

```
1. ุงูุชุญ ุงููุชุตูุญ
2. ุงูุชุญ Developer Tools (F12)
3. ุงุฐูุจ ุฅูู ุชุจููุจ Console
4. ุงูุตู ูุฐุง ุงูููุฏ:

fetch('https://YOUR_PROJECT_ID.supabase.co/functions/v1/make-server-1573e40a/health')
  .then(r => r.json())
  .then(console.log)

5. ุงุถุบุท Enter
```

### ุงููุชูุฌุฉ ุงููุชููุนุฉ:
```json
{
  "status": "ok",
  "message": "KKU Course Registration System - Connected to PostgreSQL",
  "timestamp": "2024-11-30T..."
}
```

โ **ุฅุฐุง ุฑุฃูุช ูุฐุง = ูุฌุญ ุงููุดุฑ!**

### ุงุฎุชุจุงุฑ 2: ุฌูุจ ุงูููุฑุฑุงุช

```javascript
fetch('https://YOUR_PROJECT_ID.supabase.co/functions/v1/make-server-1573e40a/courses')
  .then(r => r.json())
  .then(data => {
    console.log('ุนุฏุฏ ุงูููุฑุฑุงุช:', data.count);
    console.log('ุงูููุฑุฑุงุช:', data.courses);
  })
```

### ุงููุชูุฌุฉ ุงููุชููุนุฉ:
```json
{
  "success": true,
  "courses": [
    {
      "id": 1,
      "code": "ARAB 101",
      "name_ar": "ุงูููุงุฑุงุช ุงููุบููุฉ",
      "credits": 3,
      "level": 1
    },
    ...
  ],
  "count": 49
}
```

โ **ุฅุฐุง ุฑุฃูุช 49 ููุฑุฑุงู = ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ูุนูู!**

---

## โ ุงูุฎุทูุฉ 9: ุงุฎุชุจุงุฑ ุงููุธุงู ุงููุงูู

### ุงูุฅุฌุฑุงุก:
```
1. ุงูุชุญ ุงููุธุงู ูู ุงููุชุตูุญ
2. ุงูุชุญ Console (F12)
3. ุงุฐูุจ ุฅูู ุตูุญุฉ "ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ"
4. ุฃุฏุฎู ุงูุจูุงูุงุช:
   - ุงูุฑูู ุงูุฌุงูุนู: 442200001
   - ุงูุจุฑูุฏ: test@kku.edu.sa
   - ูููุฉ ุงููุฑูุฑ: Test123!
   - ุงูุงุณู: ุทุงูุจ ุงุฎุชุจุงุฑ
   - ุงููุณุชูู: 1
   - ุงูุชุฎุตุต: MIS
5. ุงุถุบุท "ุฅูุดุงุก ุงูุญุณุงุจ"
```

### ูุง ูุฌุจ ุฃู ุชุฑุงู ูู Console:
```
๐ [Signup] Full request body received: {...}
โ [Signup] Success: 442200001
```

### ูุง ูุฌุจ ุฃู ุชุฑุงู ูู ุงููุธุงู:
- ุฑุณุงูุฉ ูุฌุงุญ: "ุชู ุฅูุดุงุก ุงูุญุณุงุจ ุจูุฌุงุญ"
- ุชุญููู ุชููุงุฆู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู

### ุงูุชุญูู ูู Supabase:
```
1. ุงุฐูุจ ุฅูู Table Editor โ users
2. ูุฌุจ ุฃู ุชุฑู ุงูุตู ุงูุฌุฏูุฏ:
   | id | student_id | email            | name         |
   |----|------------|------------------|--------------|
   | 1  | 442200001  | test@kku.edu.sa  | ุทุงูุจ ุงุฎุชุจุงุฑ  |

3. ุงุฐูุจ ุฅูู Table Editor โ students
4. ูุฌุจ ุฃู ุชุฑู:
   | id | user_id | level | major | gpa  |
   |----|---------|-------|-------|------|
   | 1  | 1       | 1     | MIS   | 0.00 |
```

โ **ุฅุฐุง ุฑุฃูุช ุงูุจูุงูุงุช = ุงููุธุงู ูุชุตู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ!**

---

## ๐ฏ ููุฎุต ุงูุฎุทูุงุช (Quick Reference)

```
1. โ ุงูุชุญ Supabase Dashboard
2. โ ุงุฐูุจ ุฅูู Edge Functions
3. โ Create new function: make-server-1573e40a
4. โ ุงูุณุฎ ููุฏ ูู /๐ฅ-DEPLOY-THIS-NOW.ts
5. โ ุงูุตู ูู Function Editor
6. โ ุฃุถู Environment Variables:
     - SUPABASE_URL
     - SUPABASE_SERVICE_ROLE_KEY
7. โ Deploy
8. โ ุงุฎุชุจุฑ Health Check
9. โ ุงุฎุชุจุฑ ุฌูุจ ุงูููุฑุฑุงุช
10. โ ุงุฎุชุจุฑ ุฅูุดุงุก ุญุณุงุจ ูู ุงููุธุงู
```

---

## โ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ: "Function not found" (404)
**ุงูุณุจุจ:** Function ุบูุฑ ููุดูุฑ ุฃู ุงูุงุณู ุฎุงุทุฆ  
**ุงูุญู:** ุชุฃูุฏ ูู ุงูุงุณู `make-server-1573e40a` ุจุงูุถุจุท

### ุฎุทุฃ: "Internal Server Error" (500)
**ุงูุณุจุจ:** Environment Variables ุบูุฑ ููุฌูุฏุฉ  
**ุงูุญู:** ุชุญูู ูู Secrets ูู Function

### ุฎุทุฃ: "relation does not exist"
**ุงูุณุจุจ:** ุงูุฌุฏุงูู ุบูุฑ ููุฌูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช  
**ุงูุญู:** ููุฐ `/database_clean_install.sql` ู `/๐ฅ-INSERT-ALL-DATA.sql`

### ุฎุทุฃ: "CORS policy"
**ุงูุณุจุจ:** CORS headers ุบูุฑ ุตุญูุญุฉ  
**ุงูุญู:** ุงูููุฏ ูู `/๐ฅ-DEPLOY-THIS-NOW.ts` ูุญุชูู CORS - ุชุฃูุฏ ูู ูุณุฎู ูุงููุงู

---

## ๐ ุฅุฐุง ุงุญุชุฌุช ูุณุงุนุฏุฉ

ุฃุฑุณู ูู screenshot ูู:
1. Edge Functions page ูู Supabase (ูุธูุฑ ุงุณู Function ูุญุงูุชู)
2. Console ูู ุงููุชุตูุญ ุนูุฏ ุงุฎุชุจุงุฑ Health Check
3. ุฃู ุฑุณุงูุฉ ุฎุทุฃ ุชุธูุฑ

**ูุณุฃุณุงุนุฏู ููุฑุงู!**

---

## ๐ ุจุนุฏ ุงููุฌุงุญ

ุจูุฌุฑุฏ ูุฌุงุญ ุงููุดุฑ:

โ ุงููุธุงู ุณูุชุตู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ุชููุงุฆูุงู  
โ ููููู ุฅูุดุงุก ุญุณุงุจุงุช ุญููููุฉ  
โ ููููู ุงูุชุณุฌูู ูู ุงูููุฑุฑุงุช  
โ ุฌููุน ุงูุจูุงูุงุช ุชูุฎุฒู ูู PostgreSQL  
โ ูุง ุญุงุฌุฉ ูู Fallback - ุณูุนูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุจุงุดุฑุฉ  

**ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู! ๐**

---

**ุขุฎุฑ ุชุญุฏูุซ:** 30 ููููุจุฑ 2024  
**ุงูุญุงูุฉ:** ๐ธ ุฏููู ูุงูู ูุน ุงูุตูุฑ ูุงูุฎุทูุงุช
