# ๐๏ธ ุญู ูุดููุฉ ุงููุณุชุฎุฏููู ุงููุชุงูู

## โ ุงููุดููุฉ:

```
ุงููุณุชุฎุฏู ููุฌูุฏ ูู Supabase Auth ูููู ููุณ ูู ุฌุฏูู users
โ ุนูุฏ ูุญุงููุฉ ุงูุชุณุฌูู ูุฑุฉ ุฃุฎุฑู: "Email already registered"
```

---

## โ ุงูุญููู ุงููุชุงุญุฉ:

### **ุงูุญู 1: ุญุฐู ูุฏูู ูู Supabase Dashboard** โญ (ุงูุฃุณูู)

#### ุฎุทูุงุช:

1. **ุงูุชุญ Supabase Dashboard:**
   ```
   https://supabase.com/dashboard
   ```

2. **ุงุฐูุจ ุฅูู Authentication โ Users:**
   ```
   Project โ Authentication โ Users
   ```

3. **ุงุจุญุซ ุนู ุงููุณุชุฎุฏู:**
   ```
   ุงุณุชุฎุฏู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููุจุญุซ
   ```

4. **ุงุญุฐู ุงููุณุชุฎุฏู:**
   ```
   ุงุถุบุท ุนูู ุงูุซูุงุซ ููุงุท (...) โ Delete User
   ```

5. **ุฃุนุฏ ุงููุญุงููุฉ:**
   ```
   ุงูุขู ููููู ุงูุชุณุฌูู ุจููุณ ุงูุจุฑูุฏ ุจุฏูู ูุดุงูู โ
   ```

---

### **ุงูุญู 2: ุงุณุชุฎุฏุงู ุจุฑูุฏ ุฅููุชุฑููู ูุฎุชูู** โญ (ุงูุฃุณุฑุน)

ุจุฏูุงู ูู ุญุฐู ุงููุณุชุฎุฏู ุงููุฏููุ ุงุณุชุฎุฏู ุจุฑูุฏุงู ุฌุฏูุฏุงู:

```
ุงููุฏูู: ahmed@kku.edu.sa
ุงูุฌุฏูุฏ: ahmed.ali@kku.edu.sa

ุฃู

ุงูุฌุฏูุฏ: mohammed@kku.edu.sa
```

---

### **ุงูุญู 3: SQL Script ูุญุฐู ุฌููุน ุงููุณุชุฎุฏููู ุงููุชุงูู** โ๏ธ

**ููุงุญุธุฉ:** ูุฐุง ูู ูุญุฐู ูู Authุ ููุท ูู ุฌุฏูู users

```sql
-- 1. ุนุฑุถ ุงููุณุชุฎุฏููู ุงููุชุงูู (ููุฌูุฏูู ูู users ูููู ููุณ ููู auth_id ุตุญูุญ)
SELECT * FROM users WHERE auth_id IS NULL OR auth_id = '';

-- 2. ุญุฐู ุงููุณุชุฎุฏููู ุงููุชุงูู ูู ุฌุฏูู users
DELETE FROM users WHERE auth_id IS NULL OR auth_id = '';

-- 3. ุนุฑุถ ุงููุณุชุฎุฏููู ุงูุฐูู ููุณ ููู ุณุฌู ูู students
SELECT u.* FROM users u
LEFT JOIN students s ON s.user_id = u.id
WHERE u.role = 'student' AND s.id IS NULL;

-- 4. ุญุฐู ุงููุณุชุฎุฏููู ุงูุฐูู ููุณ ููู ุณุฌู ูู students
DELETE FROM users
WHERE id IN (
  SELECT u.id FROM users u
  LEFT JOIN students s ON s.user_id = u.id
  WHERE u.role = 'student' AND s.id IS NULL
);
```

---

### **ุงูุญู 4: ุชุญุฏูุซ ุงูููุฏ ููุชุนุงูู ุชููุงุฆูุงู** โ (ุชู ุจุงููุนู)

ุงูููุฏ ุงูุขู ูุญุงูู:
1. ุงูุชุญูู ูู users ุฃููุงู
2. ุฅุฐุง ูุงู ุงูุจุฑูุฏ ููุฌูุฏ ูู Auth ููุทุ ูุญุงูู ุญุฐูู
3. ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุจุนุฏ ุงูุญุฐู

**ููู ูุฏ ูุง ูุนูู ุฏุงุฆูุงู ุจุณุจุจ ุตูุงุญูุงุช Auth**

---

## ๐ฏ ุงูุญู ุงููุซุงูู (ุฎุทูุฉ ุจุฎุทูุฉ):

### **ูููุณุชุฎุฏููู ุงูุนุงูููู:**

#### 1. ุงูุชุญ Supabase Dashboard:
```
https://app.supabase.com/project/[your-project-id]/auth/users
```

#### 2. ุงุนุฑุถ ุฌููุน ุงููุณุชุฎุฏููู:
```
ุณุชุฑู ูุงุฆูุฉ ุจุฌููุน ุงููุณุชุฎุฏููู ูู Auth
```

#### 3. ุชุญูู ูู ุงููุณุชุฎุฏููู ุงููุชุงูู:
ุงูุชุญ SQL Editor ูุดุบู:
```sql
-- ุนุฑุถ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุฌููุน ุงููุณุชุฎุฏููู ูู ุฌุฏูู users
SELECT email FROM users;
```

#### 4. ูุงุฑู ุงูููุงุฆู:
```
ุงููุณุชุฎุฏููู ูู Auth ูููู ููุณูุง ูู users = ูุชุงูู
โ ุงุญุฐููู ูู Auth Dashboard
```

#### 5. ุงุญุฐู ุงููุณุชุฎุฏููู ุงููุชุงูู:
```
ูู Authentication โ Users
ุงุถุบุท [...] ุจุฌุงูุจ ูู ูุณุชุฎุฏู ูุชูู
ุงุฎุชุฑ "Delete User"
```

---

## ๐ ุฏููู ุณุฑูุน ูุญุฐู ูุณุชุฎุฏู ูุชูู:

### ุฅุฐุง ูุงู ุงูุจุฑูุฏ: `test@kku.edu.sa`

```
1. ุงูุชุญ Supabase Dashboard
2. Authentication โ Users
3. ุงุจุญุซ: test@kku.edu.sa
4. [...] โ Delete User
5. ุชุฃููุฏ ุงูุญุฐู
6. โ ุงูุขู ููููู ุงูุชุณุฌูู ุจููุณ ุงูุจุฑูุฏ
```

---

## ๐งช ุงุฎุชุจุงุฑ ุงูุญู:

### ุจุนุฏ ุญุฐู ุงููุณุชุฎุฏู ุงููุชูู:

1. **ุงูุชุญ ุงููููุน**
2. **ุงุฐูุจ ูุตูุญุฉ ุงูุชุณุฌูู**
3. **ุงุณุชุฎุฏู ููุณ ุงูุจุฑูุฏ ุงููุญุฐูู**
4. **ุงููุฃ ุฌููุน ุงูุญููู**
5. **ุงุถุบุท "ุฅูุดุงุก ุญุณุงุจ"**
6. **โ ูุฌุจ ุฃู ููุฌุญ ุจุฏูู ุฎุทุฃ "already registered"**

---

## โ๏ธ ููุน ุงููุดููุฉ ูู ุงููุณุชูุจู:

ุงูููุฏ ุงูุขู ูุญุชูู ุนูู:

### 1. Rollback ุชููุงุฆู:
```typescript
ุฅุฐุง ูุดู users โ ุญุฐู ูู Auth โ
ุฅุฐุง ูุดู students โ ุญุฐู ูู users + Auth โ
```

### 2. ูุญุงููุฉ ุญุฐู ุงููุณุชุฎุฏููู ุงููุชุงูู:
```typescript
if (authError && authError.message?.includes('already been registered')) {
  // ูุญุงููุฉ ุญุฐู ุงููุณุชุฎุฏู ุงููุฏูู
  // ุฅุนุงุฏุฉ ุงููุญุงููุฉ
}
```

### 3. ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ:
```typescript
"This email is already registered. 
If you created an account before but it failed, 
please contact support or try a different email."
```

---

## ๐ฏ ุงูุชูุตูุงุช:

### **ูููุณุชุฎุฏู:**
โ ุงุณุชุฎุฏู ุจุฑูุฏุงู ูุฎุชููุงู ุฅุฐุง ูุงุฌูุช ูุดููุฉ
โ ุฃู ุงุชุตู ุจุงูุฏุนู ูุญุฐู ุงูุญุณุงุจ ุงููุฏูู

### **ูููุทูุฑ (ุฃูุช):**
โ ุงุญุฐู ุงููุณุชุฎุฏููู ุงููุชุงูู ูู Supabase Dashboard
โ ุงูููุฏ ุงูุขู ูููุน ุงููุดููุฉ ูู ุงููุณุชูุจู

### **ููุนุฑุถ ุงูุชูุถูุญู:**
โ ุงุณุชุฎุฏู ุจุฑูุฏ ุฌุฏูุฏ ููู ุงุฎุชุจุงุฑ
โ ุฃู ุงุญุฐู ุงููุณุชุฎุฏููู ุงููุฏุงูู ูุจู ุงูุนุฑุถ

---

## ๐ ุญุงูุงุช ุงูุงุฎุชุจุงุฑ:

### โ ุญุงูุฉ 1: ูุณุชุฎุฏู ุฌุฏูุฏ ุชูุงูุงู
```
ุงูุจุฑูุฏ: ahmed@kku.edu.sa (ุบูุฑ ููุฌูุฏ)
โ ุงูุชุณุฌูู ููุฌุญ โ
```

### โ ุญุงูุฉ 2: ูุณุชุฎุฏู ููุฌูุฏ ุจุงููุงูู
```
ุงูุจุฑูุฏ: ahmed@kku.edu.sa (ููุฌูุฏ ูู Auth + users + students)
โ ุฑุณุงูุฉ: "Student ID or email already exists" โ
```

### โ๏ธ ุญุงูุฉ 3: ูุณุชุฎุฏู ูุชูู (Auth ููุท)
```
ุงูุจุฑูุฏ: test@kku.edu.sa (ููุฌูุฏ ูู Auth ููุท)
โ ุงูููุฏ ูุญุงูู ุญุฐูู ุชููุงุฆูุงู
โ ุฅุฐุง ูุดู: ุฑุณุงูุฉ ูุงุถุญุฉ ูููุณุชุฎุฏู
```

---

## ๐ก ูุตูุญุฉ ููุนุฑุถ ุงูุชูุถูุญู:

### ูุจู ุงูุนุฑุถ:

1. **ูุธูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
   ```sql
   -- ุงุญุฐู ุฌููุน ุงููุณุชุฎุฏููู ุงูุชุฌุฑูุจููู
   DELETE FROM students WHERE user_id IN (SELECT id FROM users WHERE email LIKE '%test%');
   DELETE FROM users WHERE email LIKE '%test%';
   ```

2. **ุงุญุฐู ูู Auth Dashboard:**
   ```
   ุงุญุฐู ุฌููุน ุงููุณุชุฎุฏููู ุงูุชุฌุฑูุจููู ูู Authentication โ Users
   ```

3. **ุณุฌูู ุญุณุงุจ ูุงุญุฏ ูุธูู:**
   ```
   ุงุณุชุฎุฏู ุจูุงูุงุชู ุงูุญููููุฉ
   ุชุฃูุฏ ูู ูุฌุงุญ ุงูุชุณุฌูู
   ูุง ุชุญุฐู ูุฐุง ุงูุญุณุงุจ
   ```

4. **ุฌููุฒ ุญุณุงุจุงุช ููุนุฑุถ:**
   ```
   ุญุณุงุจ ุทุงูุจ: student1@kku.edu.sa
   ุญุณุงุจ ูุดุฑู: supervisor1@kku.edu.sa
   ุญุณุงุจ ูุฏูุฑ: admin1@kku.edu.sa
   ```

---

## ๐ ุงูุฎูุงุตุฉ:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุงูุญู ุงูุฃุณุฑุน: ุงุณุชุฎุฏู ุจุฑูุฏ ูุฎุชูู
โ ุงูุญู ุงูุฃูุถู: ุงุญุฐู ูู Supabase Dashboard
โ ุงูููุฏ ุงูุขู ูููุน ุงููุดููุฉ ูุณุชูุจูุงู
โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูููุณุชุฎุฏู
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ:

### ุฃุฑุณู ูู:
1. ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุงููุณุชุฎุฏู
2. Screenshot ูู ุฑุณุงูุฉ ุงูุฎุทุฃ
3. Supabase Edge Function Logs

### ุฃู:
- ุงุณุชุฎุฏู ุจุฑูุฏุงู ุฌุฏูุฏุงู ูููุงู
- ุชุฃูุฏ ูู ุฃูู ูู ุงููุดุฑูุน ุงูุตุญูุญ ูู Supabase

---

**๐ ุงูุญู ุจุณูุท: ุงุญุฐู ูู Dashboard ุฃู ุงุณุชุฎุฏู ุจุฑูุฏ ุฌุฏูุฏ!**
